{"componentChunkName":"component---src-templates-blog-post-js","path":"/solving-ai-concurrent-issue/","result":{"data":{"site":{"siteMetadata":{"title":"Onepredict Engineering"}},"markdownRemark":{"id":"4449dd8e-b371-56aa-a607-29f2656876eb","excerpt":"기존에 발행된 글을\n정리해서 다시 소개합니다. Intro Substation 2.0 제품을 개발하며 새로운 기능을 만드는 와중에,\n기존 백엔드 서버에서 동작하던 AI 연산부에서\n치명적인 이슈를 발견한 적이 있습니다. 해당 이슈는 스프린트 플래닝 과정에서 PO…","html":"<blockquote>\n<p><a href=\"https://tech.onepredict.ai/3461d6cc-bc49-423a-b9c8-de816776461f\">기존에 발행된 글</a>을\n정리해서 다시 소개합니다.</p>\n</blockquote>\n<h2 id=\"intro\" style=\"position:relative;\"><a href=\"#intro\" aria-label=\"intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Intro</h2>\n<p>Substation 2.0 제품을 개발하며 새로운 기능을 만드는 와중에,\n기존 백엔드 서버에서 동작하던 AI 연산부에서\n치명적인 이슈를 발견한 적이 있습니다.</p>\n<p>해당 이슈는 스프린트 플래닝 과정에서 PO와 당시 옆에 있었던 프론트 대빵,\n그리고 팀 내 개발자 등 당시  180cm가 넘는 거구들과 화이트보드 앞에서\n열띤 토의를 했고(심리적 압박감 무엇..?),\n아래 이슈로 인해서 백엔드와 AI를 분리하기로 했습니다.</p>\n<p><del>스프린트를 거듭할수록 왜 이런 부류의 개발 난이도가 계속 발생하는가?!</del></p>\n<h2 id=\"issue\" style=\"position:relative;\"><a href=\"#issue\" aria-label=\"issue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Issue</h2>\n<p>Substation2.0 서비스에서 AI 알고리즘이 동작하는 순간은 크게 3가지로 분류됩니다.</p>\n<ol>\n<li>신규 고객이 서브스테이션에 변압기 및 DGA(절연유 가스) 데이터를\n처음 등록할 때 (Bulk Upload)</li>\n<li>기존 변압기의 DGA 가스 이력을 새로 추가할 때 (Web Upload)</li>\n<li>작업자가 변압기 점검일지를 작성할 때</li>\n</ol>\n<p>이 중 3번째 상황에서 여러 사람이 점검일지를 동시에 작성하게 되면,\nAI 알고리즘도 동시에 여러 개가 돌아가야 합니다.\n하지만 AI 개발자가 처음 알고리즘을 개발했을 때는 동시 실행이 불가능한 구조로\n설계를 해뒀습니다.</p>\n<p><strong><u>즉, 백엔드 서버가 동시에 여러 개의 API 요청을 받을 수 있고,\n동시에 여러 개의 DB 트랜잭션도 가능하지만,\nAI 연산은 오직 1개의 프로세스만 가능한 구조입니다.</u></strong></p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/414a176b050f3c081022879d2672cabe/97bfd/flask_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABiUlEQVR42mWR2Y7TQBBF/ek88y+IR56QQKBBKMvMJIrjjBNnc7wmbu/dbjs+0xFPQEulqlapbunWsfjnKd1TyYFaDdzymiBOKduOWvYUjaI00aietrvTmjyO41/z1v1+J68KM5whVUtuBg5GZB8EvJ19njcHXD/gHIfEZkFSKY5RxCmOScsWKVtUW5lcMQw9ltIKL95jnx3OVx/v5LPZPLFzv+F6UwIhzP8H7vanEfWYvM5w1l85HJ7wozNlkZCENlnyRq8rLKkkYijIqUialIW95nia0vc74tRmulyQpq8U3hecX5+YvEyMyJK23TBfznh5/g1jwqhDdFdgtUYw1RnZmHMpQ+aLJZfLzNiwud1sVluXKJpz/f6R7ecPrDdzinJFU69wPIe9Z8M9ZFA+nRRYutdkrSDrcoTMia7CWDsSJluiW2As14TXE/5xjn9yuIgCP3ZN7EyvoKpKs1wgm8y4UlgPMg9Sf2iNdPpBsyMzBxcGQF5LUzdkj7rRiFpxe/TqztDX/1F+B3UwDb0ledNYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"기존 동작 Process\"\n        title=\"기존 동작 Process\"\n        src=\"/static/414a176b050f3c081022879d2672cabe/0b533/flask_1.png\"\n        srcset=\"/static/414a176b050f3c081022879d2672cabe/fac75/flask_1.png 125w,\n/static/414a176b050f3c081022879d2672cabe/63868/flask_1.png 250w,\n/static/414a176b050f3c081022879d2672cabe/0b533/flask_1.png 500w,\n/static/414a176b050f3c081022879d2672cabe/1d69c/flask_1.png 750w,\n/static/414a176b050f3c081022879d2672cabe/00d43/flask_1.png 1000w,\n/static/414a176b050f3c081022879d2672cabe/97bfd/flask_1.png 1078w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">기존 동작 Process</figcaption>\n  </figure></p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/06b157244bc37531cffd4056b2424342/7a1fb/flask_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABqklEQVR42l2SW4/TMBCF86P5JTzwyit/ACQkWCS0SICE1BVt2bJtSpLm1sRJmqsdt/2YZMVqxVgjH2vOOb6MHZ7F9XplMJa2N5IaVVYU1WnGTTdI9oKHed3rES3cSfNPO4Vjz1YKBmsnwkhcDcSngaTWrPchi98eeX+m7C1595iF4GI4kzWT7vxkeLlccLxjwM8/K7bxlqrrcP0tm81nlstP+KlPkCUz3jx8ISlS9uFe1jfcb27xIg+te7LkgYO3xpoTjhoKUp2RjTmqqfFDMS7vKIoF4dEnViFp/J1g95EgWJOWMaX6QaEW7A9burbC9h5D7TLqI05pKipqGQ2qrTnErpB+0TYizn0OWUzk3rB68wL/wytS5dG29zT1Ugx31HUJl0QyQ/dimPeKfCzJjZoNI3mCslpRV9NpEmK5ZuB94+79S76+ey0njijKFapYy5OEYn7iamLOOkZ3GY6xhs70dLpj0FpMGiJVirAgOfWkVTvjXZTw9uaWfaKkXnCYOGWHGUfsqDFmmBvr/P9tRmuFZOeOTxtobWQe6QeN6+5E+Fgz4/mpw8/jL6wmXCOI+BlGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AI 연산 중에 또다른 AI 요청이 들어오면 Exception...\"\n        title=\"AI 연산 중에 또다른 AI 요청이 들어오면 Exception...\"\n        src=\"/static/06b157244bc37531cffd4056b2424342/0b533/flask_2.png\"\n        srcset=\"/static/06b157244bc37531cffd4056b2424342/fac75/flask_2.png 125w,\n/static/06b157244bc37531cffd4056b2424342/63868/flask_2.png 250w,\n/static/06b157244bc37531cffd4056b2424342/0b533/flask_2.png 500w,\n/static/06b157244bc37531cffd4056b2424342/1d69c/flask_2.png 750w,\n/static/06b157244bc37531cffd4056b2424342/00d43/flask_2.png 1000w,\n/static/06b157244bc37531cffd4056b2424342/7a1fb/flask_2.png 1030w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">AI 연산 중에 또다른 AI 요청이 들어오면 Exception...</figcaption>\n  </figure></p>\n<h3 id=\"어떻게-해결하지\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%B4%EA%B2%B0%ED%95%98%EC%A7%80\" aria-label=\"어떻게 해결하지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어떻게 해결하지?</h3>\n<h4 id=\"ai-알고리즘-연산부를-동시-처리가-가능하도록-바꾸자\" style=\"position:relative;\"><a href=\"#ai-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98-%EC%97%B0%EC%82%B0%EB%B6%80%EB%A5%BC-%EB%8F%99%EC%8B%9C-%EC%B2%98%EB%A6%AC%EA%B0%80-%EA%B0%80%EB%8A%A5%ED%95%98%EB%8F%84%EB%A1%9D-%EB%B0%94%EA%BE%B8%EC%9E%90\" aria-label=\"ai 알고리즘 연산부를 동시 처리가 가능하도록 바꾸자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AI 알고리즘 연산부를 동시 처리가 가능하도록 바꾸자</h4>\n<p>해당 이슈를 처음 발견했을 때는 AI 연산 코드를 동시 처리 되도록 수정하면 되지\n싶어서 해당 코드를 훑어봤습니다.\n하지만 하나의 함수가 600~700줄이 넘는 코드를 리팩토링할 엄두가 나지 않았고,\nADSP 라는 자잘한 데이터 분석 자격증을 가지고는 있지만 <sup id=\"fnref-주1\"><a href=\"#fn-주1\" class=\"footnote-ref\">주1</a></sup>\n당시엔 도메인 지식도 부족했고,\n실무에서 사용하는 AI 코드를 건드리는 것은 Risk가 크다고 판단됐습니다.\n현 스프린트 일정 내에 처리하기엔 배보다 배꼽이 더 큰 상황이었습니다.</p>\n<h4 id=\"ai-연산을-큐에-쌓아두자\" style=\"position:relative;\"><a href=\"#ai-%EC%97%B0%EC%82%B0%EC%9D%84-%ED%81%90%EC%97%90-%EC%8C%93%EC%95%84%EB%91%90%EC%9E%90\" aria-label=\"ai 연산을 큐에 쌓아두자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AI 연산을 큐에 쌓아두자</h4>\n<p>AI 연산하는 부분을 큐에 쌓아 두어서,\n순차적으로 돌리게 하자라는 의견도 나왔습니다.</p>\n<p>얼핏 보면 그럴듯한 해결 방법으로 생각할 수 있지만,\n이 방법은 제품의 사용자가 많아지면 많아질수록\n큐 대기 시간이 증가하게 되는 문제가 있습니다.\n트래픽이 많아지거나 시간이 지날수록 고객에게 좋은 서비스를 제공하지 못하는\n구조는 개발자로서 제 자존심이 허락하지 않습니다.</p>\n<h4 id=\"backend-서버와-ai를-분리하자\" style=\"position:relative;\"><a href=\"#backend-%EC%84%9C%EB%B2%84%EC%99%80-ai%EB%A5%BC-%EB%B6%84%EB%A6%AC%ED%95%98%EC%9E%90\" aria-label=\"backend 서버와 ai를 분리하자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Backend 서버와 AI를 분리하자</h4>\n<p>Clean Architecture나 DDD 관련 서적을 찾아보면,\n개발할 때 유지보수 측면에서 코드 간 응집도는 높이고 결합도는 낮게 설계하도록\n권장하고 있습니다.\n평소에도 Backend와 AI 간에 관심사의 분리가 필요하다고 생각했고,\nDB와 강결합 되어 있는 AI 코드를 간섭이 없는 순수한 함수 형태로 떼어내서\n이 AI 연산부를 별도의 여러 대의 서버에서 구현하게 하면\n구조적으로 해결 가능할 것 같았습니다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0270196d0db041d34c1befd0e899376d/af590/flask_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.199999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACJklEQVR42mVSy27UQBD0P3HixIEv4Bf4AuATOCKExBEJJBQJcYITEhIBiSTSkg3kTdbezWa9u/bY48c8PeOd8dgexhAJRErdx6ru6i7PWtt1raveoetcdW3ryg7oXWvTclI2TWNvwNsonVFZ8jqMISwJxAxXChZEa91ZCyf7861HweuH8e4bLdmg13d/ybSSed3HTI+O/c+jwx/+krU2pUKZHl8dhc/vLR/fip7ezd4+IGD+P5kwHpNNEAbz1eRidhKuz9dpuEjQ9Gp19WVr9fL+6skd/uz24tMrUSvTNG3bGtMYM/jyCkwBkX6ws7f37vR0+/jow3p9cHjugzRL1iH+/p5+fQEnI6nURqQUrU6P9ki5VBI1jfZKwhy5xNNaTmvhV9V0ejkO07wSAqHS6ZtuOJsQzLaZZPOD0UfBV0YBJ+ZhVgEi0vxCVBNGzup6dnK2u737LQbJtbPBZM857TaxNantkG2hqpZKSQ9RHiGeDWSfsgllfoGCRVLwSjDGYJbBNKWMjfdHNV/ZtuzUIKFENExmlUwwR9gtHDgy4wEh/ixKojhhjEop/7wfgKjVpTXQNsC2uZaRdpPdDRNaJ/AnYTNM54xdpPn0EhT743GeZwCAOI4RQhgjs4G9jjsV2QYqsda69rj7c2UiJBZpMQfZEhYJU8tCKK2vI/YbxhjBS8EzTtNaFFIg9zPP5Q5TjrnMECtIVVKBqw2izMX03yS65W/G8xcK7ZWN92hygAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AI 연산부를 AWS Lambda 로 분리\"\n        title=\"AI 연산부를 AWS Lambda 로 분리\"\n        src=\"/static/0270196d0db041d34c1befd0e899376d/0b533/flask_3.png\"\n        srcset=\"/static/0270196d0db041d34c1befd0e899376d/fac75/flask_3.png 125w,\n/static/0270196d0db041d34c1befd0e899376d/63868/flask_3.png 250w,\n/static/0270196d0db041d34c1befd0e899376d/0b533/flask_3.png 500w,\n/static/0270196d0db041d34c1befd0e899376d/af590/flask_3.png 626w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">AI 연산부를 AWS Lambda 로 분리</figcaption>\n  </figure></p>\n<h3 id=\"lambda-도입\" style=\"position:relative;\"><a href=\"#lambda-%EB%8F%84%EC%9E%85\" aria-label=\"lambda 도입 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lambda 도입</h3>\n<p>AI 서버를 분리하기에 앞서,\n“하나의 EC2 서버에 쿠버네티스와 비슷한 환경을 구현해\n여러 AI 컨테이너를 띄울 것인가?”,\n“2, 3개의 EC2 서버를 띄울 것인가?”\n아니면\n“Lambda를 이용해 함수를 호출할 때만 비용이 나가게 할 것인가?”에 대한\n고민이 있었습니다.</p>\n<p>개발 난이도만 본다면 여러 대의 EC2를 사용해서 구현하는 게 가장 쉽고,\n쿠버네티스, Lambda 순으로 어려울 거라 생각됐지만,\n비용적인 측면을 고려한다면 압도적으로 Lambda가 저렴했습니다.\n또한 최소한의 비용으로 최대의 효율이 뽑아내도록 하는 것이\n백엔드 개발자로서 숙명이라 생각해 Lambda로 결정했습니다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2847d6a29f91b206634cf2d9d91f4537/01e7c/aws_lambda.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.4%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABjElEQVR42mNgAIL/9fVM/1eFMgOZjP/r7VlAfAZKwX+gYVfqtdgYqAHutpqLb0nSLrlWbXL9/wzbmv+zLYTAloSGMq8CYrAPQPg/0AdgX0B89D+UASrHwAT1FSPDhiR1qXMlhg+vVJj8v1tv9utJq9ntJy3mq/7/BwcB2OUkuW5/lqHKhTKjP6eKDf9dKjf+e7Hc6PSFcqON/9c5C3/pt034MsEm8Wu/Td53IPvXZHuTHz02aj8nWOp8nmDj/KXP1u17n63T5z4bl899lk7/u125wQaeLzX6e7rY8P+lCuP/12rNLl6vNln3f6aj8tc+u7TvE2wzgJpSvvbZhHydaG3xbYJN6Jd+m9SvE6zzv020jf42wa7460SbtG8TrIG0vQzDriRDqbOlRo8ulhn/v1tn9uvPPL+b7yY4rQWGCwvYy/9RvQwKL4LevlZlLLk1Taf4erXx5f9TLKqetJkKgzXPNGaFJCMghkcOAzhCzoDkQBEDkgPRIIwe3qtWMTBTJdmAkwLUa0CaokQNAIzSyB0tM6wdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Aws Lambda\"\n        title=\"AWS Lambda\"\n        src=\"/static/2847d6a29f91b206634cf2d9d91f4537/0b533/aws_lambda.png\"\n        srcset=\"/static/2847d6a29f91b206634cf2d9d91f4537/fac75/aws_lambda.png 125w,\n/static/2847d6a29f91b206634cf2d9d91f4537/63868/aws_lambda.png 250w,\n/static/2847d6a29f91b206634cf2d9d91f4537/0b533/aws_lambda.png 500w,\n/static/2847d6a29f91b206634cf2d9d91f4537/01e7c/aws_lambda.png 512w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">AWS Lambda</figcaption>\n  </figure></p>\n<h3 id=\"efs-elastic-file-system\" style=\"position:relative;\"><a href=\"#efs-elastic-file-system\" aria-label=\"efs elastic file system permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EFS (Elastic File System)</h3>\n<p><a href=\"https://aws.amazon.com/ko/efs\">https://aws.amazon.com/ko/efs</a></p>\n<p>AI 코드를 Lambda로 분리하기 위해서는 필요한 Python 패키지를 설치해야\n하는데, AI 분야에서 사용하는 라이브러리는 보통 용량이 큰 편이었습니다.</p>\n<p>Lambda에서 실행할 수 있는 형태로 올리기 위해서는 Zip 압축 파일로 올리거나,\nS3 Bucket에 올려야 하는데, 각각 50MB, 160MB의 용량 제한이 있습니다.\n의존성까지 포함해서 2GB가 넘어가는 프로그램을 Lambda에 올리기 위해서는\n대안이 필요했습니다.</p>\n<p>DevOps 팀의 열정적인 분에게 찾아가 조언을 구하니\nAWS EFS(Elastic File System)을 활용해서 패키지를 설치하고,\nEC2에서 가져다 쓰게 설정하면 해결이 가능할 것 같다는 조언을 받을 수 있었습니다.\n이를 구성하기까지 많은 시행착오가 있었지만,\n덕분에 Lambda를 돌릴 수 있는 환경을 구축했습니다.</p>\n<p><del>이렇게 해도 해결하기 어렵다면 Lambda Layer를 고려해 보려 했지만,\n다행히 성공했기에 Pass...</del></p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 332px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHeStgWhUT/xAAYEAEBAAMAAAAAAAAAAAAAAAABAgMgIf/aAAgBAQABBQJ4YLW9P//EABYRAAMAAAAAAAAAAAAAAAAAABARIf/aAAgBAwEBPwFwf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAQADAAAAAAAAAAAAAAAAAAEAAiD/2gAIAQEABj8Clhz/AP/EABsQAQACAwEBAAAAAAAAAAAAAAEAESFBURAx/9oACAEBAAE/IVY0taIODlv44eeW93LexXs//9oADAMBAAIAAwAAABCfD//EABYRAQEBAAAAAAAAAAAAAAAAAAEQEf/aAAgBAwEBPxAAjJ//xAAWEQEBAQAAAAAAAAAAAAAAAAABECH/2gAIAQIBAT8QTZ//xAAdEAEAAgICAwAAAAAAAAAAAAABESEAMRBRQXGB/9oACAEBAAE/EHHQFglcbXJLERHk164uLfWbra7ycW13n//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Aws EFS\"\n        title=\"AWS EFS\"\n        src=\"/static/490e1004d242a7ec8d4a06378f944da2/71bac/aws_efs.jpg\"\n        srcset=\"/static/490e1004d242a7ec8d4a06378f944da2/aa2ed/aws_efs.jpg 125w,\n/static/490e1004d242a7ec8d4a06378f944da2/0479a/aws_efs.jpg 250w,\n/static/490e1004d242a7ec8d4a06378f944da2/71bac/aws_efs.jpg 332w\"\n        sizes=\"(max-width: 332px) 100vw, 332px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">AWS EFS</figcaption>\n  </figure>\n<a href=\"https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html\">https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html</a></p>\n<h3 id=\"lambda-함수-마운트-폴더-설정\" style=\"position:relative;\"><a href=\"#lambda-%ED%95%A8%EC%88%98-%EB%A7%88%EC%9A%B4%ED%8A%B8-%ED%8F%B4%EB%8D%94-%EC%84%A4%EC%A0%95\" aria-label=\"lambda 함수 마운트 폴더 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lambda 함수 마운트 폴더 설정</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> sys\n\nsys<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token string\">\"/mnt/efs/packages\"</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\"># 마운트 폴더 설정</span>\n\n<span class=\"token keyword\">from</span> MtrAPI <span class=\"token keyword\">import</span> MtrAPI\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">lambda_handler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> \n    ai_processing_result <span class=\"token operator\">=</span> MtrAPI<span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">return</span> ai_processing_result</code></pre></div>\n<p>이렇게 기존 Substation 제품의 AI 동시성 이슈에 대해서\n구조적으로 Backend 파트와 AI 연산 파트를 분리해서 결합도를 낮췄고,\n분리된 AI 파트를 AWS Lambda를 활용해서\n별도의 AI 서버를 통한 로드 밸런싱 없이 다중 처리가 가능하도록 수정했습니다.</p>\n<h2 id=\"새로운-이슈의-등장\" style=\"position:relative;\"><a href=\"#%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%9D%B4%EC%8A%88%EC%9D%98-%EB%93%B1%EC%9E%A5\" aria-label=\"새로운 이슈의 등장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>새로운 이슈의 등장</h2>\n<p>해당 기능을 만들면서 단일 변압기 설비에 대한 AI 연산이 많이 발생할 것으로\n기대했으나,\n시간이 지나 추가된 기획에 의하면 오히려 단일 설비보다\n회사 전체 설비에 대한 AI 연산을 돌리는 기능이 많아질 것으로 확인되었습니다.\n이런...</p>\n<p>설비 하나의 AI 연산은 약 4~5초 걸리지만,\n회사 전체 설비에 대해 AI 연산이 필요하다면 구조적인 개선뿐만 아니라\n성능 개선 또한 같이 이루어져야 했습니다.</p>\n<h4 id=\"boto3-비동기\" style=\"position:relative;\"><a href=\"#boto3-%EB%B9%84%EB%8F%99%EA%B8%B0\" aria-label=\"boto3 비동기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Boto3 비동기?</h4>\n<p>처음에는 AWS Lambda 함수 호출을 비동기로 처리하는 것을 고려해 봤습니다.\nAWS에서 Lambda를 공식적으로 지원해 주는 Python 라이브러리로 Boto3 가 있습니다.\n아래와 같은 방식으로 Boto3 Session을 만들어서 쓰면\nAI 연산이 Lambda에서 동기식으로 정상 동작하는 것을 확인할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 동기 방식</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">execute_lambda</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    lambda_client <span class=\"token operator\">=</span> get_boto3_session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    function_name <span class=\"token operator\">=</span> <span class=\"token string\">\"substation_lambda\"</span>\n    \n    <span class=\"token comment\"># Lambda 함수 실행</span>\n    response <span class=\"token operator\">=</span> lambda_client<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span>\n        FunctionName<span class=\"token operator\">=</span>function_name<span class=\"token punctuation\">,</span> Payload<span class=\"token operator\">=</span>json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span>\n    result <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">[</span><span class=\"token string\">\"Payload\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> result</code></pre></div>\n<p>다만 ‘성능’과 ‘동시성’ 처리를 위해\n<strong>비동기 방식으로 요청하기 위해 여러 삽질이 있었고,\nBoto3 1.26.94 버전 공식 매뉴얼에서 해당 기능이 deprecated 되었고,\n응답 코드만 받아올 수 있다는 결론을 얻게 되었습니다.</strong> <sup id=\"fnref-주2\"><a href=\"#fn-주2\" class=\"footnote-ref\">주2</a></sup></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># 비동기 방식</span>\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">def</span> <span class=\"token function\">execute_lambda_async</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    lambda_client <span class=\"token operator\">=</span> get_boto3_session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Lambda 함수 실행</span>\n    response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> asyncio<span class=\"token punctuation\">.</span>get_running_loop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>run_in_executor<span class=\"token punctuation\">(</span>\n        <span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n        lambda_client<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string\">\"FunctionName\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"substation_lambda\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Payload\"</span><span class=\"token punctuation\">:</span> payload<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">\"Payload\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>여기까지 오기에도 많은 시간과 에너지를 소모했지만, 뭔가 2% 부족했습니다.</p>\n<p>실제로 많은 변전소 설비와 DGA 데이터를 담고 있는 Excel 파일을 Bulk Upload할 때\n동기식으로 연산하게 되면 많은 시간이 소요되었습니다.</p>\n<h4 id=\"동기식-처리시-소요-시간\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EA%B8%B0%EC%8B%9D-%EC%B2%98%EB%A6%AC%EC%8B%9C-%EC%86%8C%EC%9A%94-%EC%8B%9C%EA%B0%84\" aria-label=\"동기식 처리시 소요 시간 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동기식 처리시 소요 시간</h4>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">    start_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> asset <span class=\"token keyword\">in</span> asset_list<span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># AI Input 데이터 추출</span>\n        feature <span class=\"token operator\">=</span> get_feature<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> asset<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># AI 연산 시작</span>\n        result <span class=\"token operator\">=</span> execute_lambda<span class=\"token punctuation\">(</span>feature<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"status\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> Exception<span class=\"token punctuation\">(</span><span class=\"token string\">\"Ai Lambda 연산 중에 에러가 발생했습니다\"</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token comment\"># AI 연산 결과 저장</span>\n        save_result<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"response\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    end_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    elapsed_time <span class=\"token operator\">=</span> end_time <span class=\"token operator\">-</span> start_time  <span class=\"token comment\"># 경과 시간 계산</span>\n\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"실행 시간: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>elapsed_time<span class=\"token punctuation\">}</span></span><span class=\"token string\">초\"</span></span><span class=\"token punctuation\">)</span>\n        </code></pre></div>\n<p><strong>실행시간: 760.14 초</strong></p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6fa07e748eb3a9289f1e97173bf4d01e/01dae/flask_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.6%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB8klEQVR42lWRy27TQBSG84hsUF8AiW1X8BBIdIGUFYtKLAAhJCRWLSgVFYJWKWka147tOG4dx7fxXDwXz9hO7cHikrS/zuocffo/6Qy01lLViKsM0TAGGSowl5Cwu81dWcmEpIZr2Teuv/bnS7sfxHDbtvpPBlp3hJV5rRcJ/jm1zmYOkB0QjZRKbmTAk9PxaB45ZuiMrYuJO41ZWm+af3DXtYiVQY5n5pnp/DLt82BtBYDAHE0tw738HH8bpsYnUiOhpdAqEZmqVE92uhvork0hjQmy7ZFhfLHMr1E0Nj0X5MjxLO/44PJwf/XmqW+NUCfRBvfNvdMOzgmPMBTlolZu03hRMvt+MVmHkR+vgsWpf/jk/GAv+Pg8yGyqZdLD95t7OIQ5IdeUmkVhQmzfpoBSIesSNMXNydAd7l29erz68Rq0ZcKTB82wEBECjNmUWgW1+1nnUAjFJMWtSHPHe7t/9fKR/26/l8okug93VDZrCDA2CuoyNofwOgCIC8kVhxXEukkmH5z3z+LjF9g7ySpa1Wr3KipUxpsQoiADIUjTgmWiUVUtKsFbwXWZkNvcOQLzo7xMgYJVXW1hXdU1YaKXB5ihQiSQzB0vjuMgCBzPDZN1UTJSclYpXpW9Ttd1O3ibv1vG6HK5jP8HIbS964f5DSscV4o2kzeiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"여러 개의 AI 연산을 동기식으로 처리\"\n        title=\"여러 개의 AI 연산을 동기식으로 처리\"\n        src=\"/static/6fa07e748eb3a9289f1e97173bf4d01e/0b533/flask_4.png\"\n        srcset=\"/static/6fa07e748eb3a9289f1e97173bf4d01e/fac75/flask_4.png 125w,\n/static/6fa07e748eb3a9289f1e97173bf4d01e/63868/flask_4.png 250w,\n/static/6fa07e748eb3a9289f1e97173bf4d01e/0b533/flask_4.png 500w,\n/static/6fa07e748eb3a9289f1e97173bf4d01e/01dae/flask_4.png 721w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">여러 개의 AI 연산을 동기식으로 처리</figcaption>\n  </figure></p>\n<h3 id=\"병렬처리\" style=\"position:relative;\"><a href=\"#%EB%B3%91%EB%A0%AC%EC%B2%98%EB%A6%AC\" aria-label=\"병렬처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>병렬처리</h3>\n<p>Boto3 라이브러리에서 비동기를 지원하지 않는다면 파이썬 기본 기능을 이용해\n자체적으로 <strong>Thread</strong>와 <strong>Process</strong>를 활용해 구현해 보기로 했습니다.\n참고로 보통 아래의 상황에서는 Thread나 Process를 사용해서\n해당 작업을 병렬로 실행하는 것을 권장합니다.</p>\n<blockquote>\n<ul>\n<li>애플리케이션이 I/O를 처리할 때는 운영 체제가 스트림을 처리해서\n결과를 돌려줄 때까지 계속 대기한다.\n이 시간 동안 애플리케이션을 멈춰 있다.</li>\n<li>애플리케이션이 CPU를 사용하여 계산할 때 CPU 중 하나만 사용한다.\n다른 CPU는 유휴상태로 있다.</li>\n</ul>\n</blockquote>\n<h4 id=\"thrad-vs-process\" style=\"position:relative;\"><a href=\"#thrad-vs-process\" aria-label=\"thrad vs process permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Thrad VS Process</h4>\n<p>Python 언어에서는 C#, Java와 달리 GIL(Global Interpreter Lock)이란\n골칫거리 녀석이 있습니다.\nGIL은 ‘파이썬 전역 인터프리터 락’의 줄임말로 CPython이 Byte 코드를\n실행할 때마다 Thread에 Lock이 걸리게 됩니다.\n그러다 보면 Thread 여러 개로 애플리케이션을 확장하더라도 GIL로 인해\n모든 Thread가 이 GIL을 차지하기 위해 경합하게 되고, 성능이 떨어지게 됩니다.</p>\n<p>반면에 멀티 Process를 사용하게 되면 한 번에 많은 작업을 실행할 수 있습니다.\nGIL이 관여하지 않으므로 Thread보다 빠르지만,\nProcess 사이에는 어떤 메모리 공간도 공유되지 않기 때문에\nProcess에서 다른 Process로 전환하기 위해서는\n상태 없이 (stateless) 동작해야 한다는 조건을 만족해야 합니다.\n또한 Process를 사용하게 되면 네트워크 비용이 더 증가할 수 있다는\n단점이 있습니다.</p>\n<p><strong>정리하면 I/O 작업을 동시에 처리할 때는 Thread가 효율적이고,\nCPU 사용량을 최대로 끌어올리려면 많은 프로세스를 사용하는 게 효율적입니다.</strong></p>\n<p>Lambda 같은 경우도 Backend 서버에서 Lambda 함수를 호출하는 I/O 작업이기에\nThread가 좀 더 효율적일 것이라 기대했습니다.\n다만 Python의 GIL에 의한 성능저하가 우려되어 Thread를 사용할 때와\nProcess를 사용할 때를 비교해, 더 효율적인 것을 사용하기로 했습니다.</p>\n<h4 id=\"병렬처리-오류\" style=\"position:relative;\"><a href=\"#%EB%B3%91%EB%A0%AC%EC%B2%98%EB%A6%AC-%EC%98%A4%EB%A5%98\" aria-label=\"병렬처리 오류 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>병렬처리 오류</h4>\n<p>해당 파이썬 코드에서 사용할 병렬처리 라이브러리로 <code class=\"language-text\">concurrent.futures</code>를\n선택했습니다.\n기존 코드에서 Lambda를 돌릴 함수와 해당 함수에 Input 값을 넣어줄 부분을\n묶어서 하나의 병렬처리를 위한 함수로 구현하면\nThread와 Process 모두 동일한 에러가 발생했습니다.</p>\n<blockquote>\n<p><strong>TypeError(\"'dict' object is not callable\")</strong></p>\n</blockquote>\n<p><strong>ProcessPoolExecutor</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">        <span class=\"token keyword\">with</span> futures<span class=\"token punctuation\">.</span>ProcessPoolExecutor<span class=\"token punctuation\">(</span>max_workers<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> executor<span class=\"token punctuation\">:</span>\n            futures_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n                executor<span class=\"token punctuation\">.</span>submit<span class=\"token punctuation\">(</span>process_asset<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> asset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">for</span> asset <span class=\"token keyword\">in</span> assets\n            <span class=\"token punctuation\">]</span>\n            <span class=\"token comment\"># AI 알고리즘 연산 결과 저장</span>\n            <span class=\"token keyword\">for</span> future <span class=\"token keyword\">in</span> futures_list<span class=\"token punctuation\">:</span>\n                result <span class=\"token operator\">=</span> future<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">if</span> result <span class=\"token keyword\">is</span> <span class=\"token keyword\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n                    save_result<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"response\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">process_asset</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> asset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># AI 연산 Input 데이터 가공 </span>\n        feature <span class=\"token operator\">=</span> get_feature<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> asset<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># AI 연산 시작</span>\n        result <span class=\"token operator\">=</span> execute_lambda<span class=\"token punctuation\">(</span>feature<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"status\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> Exception<span class=\"token punctuation\">(</span><span class=\"token string\">\"Ai Lambda 연산 중에 에러가 발생했습니다\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> result</code></pre></div>\n<p><strong>TreadPoolExecutor</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">        <span class=\"token keyword\">with</span> futures<span class=\"token punctuation\">.</span>ThreadPoolExecutor<span class=\"token punctuation\">(</span>max_workers<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> executor<span class=\"token punctuation\">:</span>\n            futures_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n                executor<span class=\"token punctuation\">.</span>submit<span class=\"token punctuation\">(</span>process_asset<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> asset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">for</span> asset <span class=\"token keyword\">in</span> assets\n            <span class=\"token punctuation\">]</span>\n            <span class=\"token comment\"># AI 알고리즘 연산 결과 저장</span>\n            <span class=\"token keyword\">for</span> future <span class=\"token keyword\">in</span> futures_list<span class=\"token punctuation\">:</span>\n                result <span class=\"token operator\">=</span> future<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">if</span> result <span class=\"token keyword\">is</span> <span class=\"token keyword\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n                    save_result<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"response\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">process_asset</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> asset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># AI 연산 Input 데이터 가공</span>\n        feature <span class=\"token operator\">=</span> get_feature<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> asset<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\"># AI 연산 시작</span>\n        result <span class=\"token operator\">=</span> execute_lambda<span class=\"token punctuation\">(</span>feature<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"status\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> Exception<span class=\"token punctuation\">(</span><span class=\"token string\">\"Ai Lambda 연산 중에 에러가 발생했습니다\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> result</code></pre></div>\n<p>가능성이 있어 보이는 코드에는 모두 예외 처리를 했음에도 예외를 타지 않는\n에러가 발생했고,\nChatGPT의 도움을 받아보니 아래 공유 데이터에 대한 이슈가 해결의 실마리처럼\n보였습니다.</p>\n<p><strong>“스레드 간에 공유되는 데이터에 대한 접근 충돌이 있는지 확인합니다.\n스레드 간의 동시 접근을 막기 위해 동기화 메커니즘을 사용할 수 있습니다.”</strong></p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ebe603b6ce0112285ae8d396ed1ed53c/394f7/chat_gpt_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAACi0lEQVR42k2U6XLiQAyEebMNJNyHzeET8AHmCiTZbDZV+/ZafRqGyg9ZM9JYbrV63BoFa0mzoyyjnSTqs/VZ4vQgi1Utq7iRJD9JmrsY+VhtFe8l31xsz3oabOSpE8pglEqrP041sJVZWEi4KGW+rNUqCealxdi7eGUvzsKtLHQNAIw4eXIvvZW0JrO17A+fUtbvUu3eZb19Vf8h++Mf2TWfcrx8y+H0ZZ4zjcaP579yOn+bf739k0bzvDtUcK3xNJdNcbVCWKotRkkjvUEs3X5kX8VY94axxUeTTCaKiHcnas/3PNYajjOZhltrJVT4tECr4+naYoG2A5+0F8wLM84kd07JWVzPdfvaMi83xy/ZljfZaeu75re1SnsLLUJhXwiu8Y5bx2O4qCwOh4awP0wEHofaxlg9BIOMQxSDF/xokpuRm2nR0D7g2gblTNfP3aW0mCJEM4g0V/moDGyyDwSlSQZeQQOyWNeRxiyvhckjHysIyaDxozfyNYamQA/Hfs0wWJNnQD/z3X7sZENVqsNhUb2ZRwJFdbN1pgKOkoMhi+6CR6MgBimDSbKDAXoUJMkwNoVKR42B+MLICN78lKGCGOvewMnqVzuQzsvCFeSx0oKb8mqF0GS9/7DiHjWF+SBXkIGskr3dlgBZqdE27T8KgjDfXrS9s2T6Uqr32VrSFr3o2dMuLYKwqrlVF73TZ9szMBsKBSGVTft5btAx9hhrH3d7Z4jY533OEDK56EHu0VD6P4v/+zxQaevce2J273VghdICReRN2BCOBmvl6KQ/AA7CJYfs9micvQ3KJn+1D/D7Io8v6zcriJzspoT+vpqo3W8Kcft7C+lMktbbnbnzak8d70P1bsr/Adv9rpwh8gfcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ChatGPT 와의 대화\"\n        title=\"ChatGPT 와의 대화\"\n        src=\"/static/ebe603b6ce0112285ae8d396ed1ed53c/0b533/chat_gpt_1.png\"\n        srcset=\"/static/ebe603b6ce0112285ae8d396ed1ed53c/fac75/chat_gpt_1.png 125w,\n/static/ebe603b6ce0112285ae8d396ed1ed53c/63868/chat_gpt_1.png 250w,\n/static/ebe603b6ce0112285ae8d396ed1ed53c/0b533/chat_gpt_1.png 500w,\n/static/ebe603b6ce0112285ae8d396ed1ed53c/394f7/chat_gpt_1.png 707w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">ChatGPT 와의 대화</figcaption>\n  </figure></p>\n<h4 id=\"병렬처리-해결\" style=\"position:relative;\"><a href=\"#%EB%B3%91%EB%A0%AC%EC%B2%98%EB%A6%AC-%ED%95%B4%EA%B2%B0\" aria-label=\"병렬처리 해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>병렬처리 해결</h4>\n<p>GPT의 도움을 받아 고민해 보니 병렬 처리에 사용되는 <code class=\"language-text\">process_asset</code> 함수가\n마음에 걸렸습니다.</p>\n<p>Lambda 함수를 실행하기 전에 Input 값을 만들어 주는 함수가\n<strong>공유 데이터에 대한 이슈</strong>와 더불어 <strong>DB session까지 물고 있었기</strong>에\n문제의 원인이라 생각됐고,\n전반적인 레거시 코드를 수정하고 병렬처리로 사용할 <code class=\"language-text\">process_asset</code> 함수를\nLambda 실행 부분만 포함하도록 분리해 정상적으로 실행되게 만들 수 있었습니다.</p>\n<p><strong>[Before]</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">process_asset</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> asset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># AI 연산 Input 데이터 가공</span>\n    feature <span class=\"token operator\">=</span> get_feature<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> asset<span class=\"token punctuation\">.</span><span class=\"token builtin\">id</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># AI 연산 시작</span>\n    result <span class=\"token operator\">=</span> execute_lambda<span class=\"token punctuation\">(</span>feature<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"status\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> Exception<span class=\"token punctuation\">(</span><span class=\"token string\">\"Ai Lambda 연산 중에 에러가 발생했습니다\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> result</code></pre></div>\n<p><strong>[After]</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">process_asset</span><span class=\"token punctuation\">(</span>feature<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># AI 연산 시작</span>\n    result <span class=\"token operator\">=</span> execute_lambda<span class=\"token punctuation\">(</span>feature<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"status\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">raise</span> Exception<span class=\"token punctuation\">(</span><span class=\"token string\">\"Ai Lambda 연산 중에 에러가 발생했습니다\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> result</code></pre></div>\n<h3 id=\"병렬처리-성능-비교\" style=\"position:relative;\"><a href=\"#%EB%B3%91%EB%A0%AC%EC%B2%98%EB%A6%AC-%EC%84%B1%EB%8A%A5-%EB%B9%84%EA%B5%90\" aria-label=\"병렬처리 성능 비교 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>병렬처리 성능 비교</h3>\n<h4 id=\"4개-thread로-돌릴-때-시간-확인\" style=\"position:relative;\"><a href=\"#4%EA%B0%9C-thread%EB%A1%9C-%EB%8F%8C%EB%A6%B4-%EB%95%8C-%EC%8B%9C%EA%B0%84-%ED%99%95%EC%9D%B8\" aria-label=\"4개 thread로 돌릴 때 시간 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4개 Thread로 돌릴 때 시간 확인</h4>\n<p><strong>TreadPoolExecutor - 4 worker</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">    start_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># AI 연산 데이터 추출</span>\n    features <span class=\"token operator\">=</span> get_features<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> company_id<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># AI Lambda 연산</span>\n    <span class=\"token keyword\">with</span> futures<span class=\"token punctuation\">.</span>ThreadPoolExecutor<span class=\"token punctuation\">(</span>max_workers<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> executor<span class=\"token punctuation\">:</span>\n        futures_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n            executor<span class=\"token punctuation\">.</span>submit<span class=\"token punctuation\">(</span>process_asset<span class=\"token punctuation\">,</span> feature<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> feature <span class=\"token keyword\">in</span> features\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token comment\"># AI 알고리즘 연산 결과 저장</span>\n    <span class=\"token keyword\">for</span> future <span class=\"token keyword\">in</span> futures_list<span class=\"token punctuation\">:</span>\n        result <span class=\"token operator\">=</span> future<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> result <span class=\"token keyword\">is</span> <span class=\"token keyword\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            save_result<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"response\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    end_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    elapsed_time <span class=\"token operator\">=</span> end_time <span class=\"token operator\">-</span> start_time <span class=\"token comment\"># 경과 시간 계산</span></code></pre></div>\n<p><strong>실행 시간: 126.87955212593079초</strong></p>\n<h4 id=\"8개-thread로-돌릴-때-시간-확인\" style=\"position:relative;\"><a href=\"#8%EA%B0%9C-thread%EB%A1%9C-%EB%8F%8C%EB%A6%B4-%EB%95%8C-%EC%8B%9C%EA%B0%84-%ED%99%95%EC%9D%B8\" aria-label=\"8개 thread로 돌릴 때 시간 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8개 Thread로 돌릴 때 시간 확인</h4>\n<p><em><strong>TreadPoolExecutor - 8 worker</strong></em></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">    start_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># AI 연산 데이터 추출</span>\n    features <span class=\"token operator\">=</span> get_features<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> company_id<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># AI Lambda 연산</span>\n    <span class=\"token keyword\">with</span> futures<span class=\"token punctuation\">.</span>ThreadPoolExecutor<span class=\"token punctuation\">(</span>max_workers<span class=\"token operator\">=</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> executor<span class=\"token punctuation\">:</span>\n        futures_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n            executor<span class=\"token punctuation\">.</span>submit<span class=\"token punctuation\">(</span>process_asset<span class=\"token punctuation\">,</span> feature<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> feature <span class=\"token keyword\">in</span> features\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token comment\"># AI 알고리즘 연산 결과 저장</span>\n    <span class=\"token keyword\">for</span> future <span class=\"token keyword\">in</span> futures_list<span class=\"token punctuation\">:</span>\n        result <span class=\"token operator\">=</span> future<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> result <span class=\"token keyword\">is</span> <span class=\"token keyword\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            save_result<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"response\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    end_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    elapsed_time <span class=\"token operator\">=</span> end_time <span class=\"token operator\">-</span> start_time <span class=\"token comment\"># 경과 시간 계산</span></code></pre></div>\n<p><strong>실행 시간: 197.9756360054016초</strong></p>\n<h4 id=\"4개-process로-돌릴-때-시간-확인\" style=\"position:relative;\"><a href=\"#4%EA%B0%9C-process%EB%A1%9C-%EB%8F%8C%EB%A6%B4-%EB%95%8C-%EC%8B%9C%EA%B0%84-%ED%99%95%EC%9D%B8\" aria-label=\"4개 process로 돌릴 때 시간 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4개 Process로 돌릴 때 시간 확인</h4>\n<p><strong>ProcessPoolExecutor - 4 worker</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">    start_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># AI 연산 데이터 추출</span>\n    features <span class=\"token operator\">=</span> get_features<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> company_id<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># AI Lambda 연산</span>\n    <span class=\"token keyword\">with</span> futures<span class=\"token punctuation\">.</span>ProcessPoolExecutor<span class=\"token punctuation\">(</span>max_workers<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> executor<span class=\"token punctuation\">:</span>\n        futures_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n            executor<span class=\"token punctuation\">.</span>submit<span class=\"token punctuation\">(</span>process_asset<span class=\"token punctuation\">,</span> feature<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> feature <span class=\"token keyword\">in</span> features\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token comment\"># AI 알고리즘 연산 결과 저장</span>\n    <span class=\"token keyword\">for</span> future <span class=\"token keyword\">in</span> futures_list<span class=\"token punctuation\">:</span>\n        result <span class=\"token operator\">=</span> future<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> result <span class=\"token keyword\">is</span> <span class=\"token keyword\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            MtrAPI_RusultUpload<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"response\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    end_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    elapsed_time <span class=\"token operator\">=</span> end_time <span class=\"token operator\">-</span> start_time  <span class=\"token comment\"># 경과 시간 계산</span></code></pre></div>\n<p><strong>실행시간: 276.74906373023987</strong></p>\n<h4 id=\"8개-process-로-돌릴-때-시간-확인\" style=\"position:relative;\"><a href=\"#8%EA%B0%9C-process-%EB%A1%9C-%EB%8F%8C%EB%A6%B4-%EB%95%8C-%EC%8B%9C%EA%B0%84-%ED%99%95%EC%9D%B8\" aria-label=\"8개 process 로 돌릴 때 시간 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8개 Process 로 돌릴 때 시간 확인</h4>\n<p><strong>ProcessPoolExecutor - 8 worker</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">    start_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># AI 연산 데이터 추출</span>\n    features <span class=\"token operator\">=</span> get_features<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> company_id<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># AI Lambda 연산</span>\n    <span class=\"token keyword\">with</span> futures<span class=\"token punctuation\">.</span>ProcessPoolExecutor<span class=\"token punctuation\">(</span>max_workers<span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> executor<span class=\"token punctuation\">:</span>\n        futures_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n            executor<span class=\"token punctuation\">.</span>submit<span class=\"token punctuation\">(</span>process_asset<span class=\"token punctuation\">,</span> feature<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> feature <span class=\"token keyword\">in</span> features\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token comment\"># AI 알고리즘 연산 결과 저장</span>\n    <span class=\"token keyword\">for</span> future <span class=\"token keyword\">in</span> futures_list<span class=\"token punctuation\">:</span>\n        result <span class=\"token operator\">=</span> future<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> result <span class=\"token keyword\">is</span> <span class=\"token keyword\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            MtrAPI_RusultUpload<span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"response\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    end_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    elapsed_time <span class=\"token operator\">=</span> end_time <span class=\"token operator\">-</span> start_time  <span class=\"token comment\"># 경과 시간 계산</span></code></pre></div>\n<p><strong>실행시간:212.99634408950806</strong></p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3e921d164d16c8e7ed7cb5efa21ff210/6bbf7/flask_5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.199999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACBElEQVR42mWSS2/TQBSF+xNZICGxLP+AFRKrblixQrBMBRULyiabBqImVUOjNG8nNCW2kzq2x3E8znjG9vgx8SvGbYRC1as70izupzn3zDnI83y73bp+6PgMWjZ2qO2FxPWDkKVpSnyyWClzIGmmdgckYTGzXJykSf5QB8VJksRwNsCOWiOhfj0SlzYKtzYN43iDM+960ukLg7kpD/hhZ9LTqeGz4BEMkK0ac2j+0XTONMeiIq2xA3R9yNVh7wvkTrGnB3kc5owkjk2de707OIpjBWKCb7juCdctDbvH43G516kCw5A6p/y3N3elQ6X1GaW+lWArIsS1H+DtPRzHsbYmEI7XywrUzqBWmc2q/e7ZbD5tj5qjk9e/P7wQj1/JwiXJQxyRfy/v4CRRTVJopLjhkZpv17VlQxSazasLHmr9q++3n1723j9TKkeGD0nqEofs4SRJdURWK86xLqlVLRqodWnekuWZBGUJKY2vR/zH50LpUBNqOPWKD9nvnGYZtP3CKmzWXVT10A+gXmhgYMIlx48UF96Mzhflt+rPd2RSRrFLA/rI7bXLVGSPp8PJ9NdMavMSB8BtEFAU4HVo6e4KKm0k1iBWUGT7zN/DhYIiE164wY6PsIMdr4gKJoRSCjTgek7AAsqYF8Usjop7lmX/wU+qyJYoirIsC4LAGNul8OnYXy7wUH+q8f3BAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"여러 개의 AI 연산을 병렬로 처리\"\n        title=\"여러 개의 AI 연산을 병렬로 처리\"\n        src=\"/static/3e921d164d16c8e7ed7cb5efa21ff210/0b533/flask_5.png\"\n        srcset=\"/static/3e921d164d16c8e7ed7cb5efa21ff210/fac75/flask_5.png 125w,\n/static/3e921d164d16c8e7ed7cb5efa21ff210/63868/flask_5.png 250w,\n/static/3e921d164d16c8e7ed7cb5efa21ff210/0b533/flask_5.png 500w,\n/static/3e921d164d16c8e7ed7cb5efa21ff210/6bbf7/flask_5.png 716w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">여러 개의 AI 연산을 병렬로 처리</figcaption>\n  </figure></p>\n<h3 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h3>\n<p>기존의 Substation 제품에서 동시에 AI 연산을 할 수 없었던 근본적인 문제를\n해결하기 위해 Lambda를 활용해서 동시다발적으로 처리할 수 있도록 아키텍처를\n변경했고,\n예상한 대로 I/O 작업을 하는 병렬처리 작업에서는\nMulti Process보다 Multi Thread가 성능상 이점을 가진다는 것을\n확인할 수 있었습니다.</p>\n<table>\n<thead>\n<tr>\n<th>Excel Bulk Upload 기준 성능 향상 지표</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bc639605e74b4eaf4d87a62cab8a0bbe/6c2f2/result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVR42m1R2XKDMAzk/3+v00zSEELSXNxHANvYZisJaHmoZjSy16vV4SDJCnzuT0jSAl+nC8LzN6q6RRTfsA9jpHmJQ8g43Y8xca4YlJL4sQtxjK7YHc6ILnfCNYJ+UMjyCuNohdj3Cs55PF6ZuDGWfBThsmxg9EhcB6WMCGht6EzRGDjrEDC5at5w3mOaJhFjK6oGZdUSJld0/QBFyWzTAnLsqAHv1zsQsEDTdiTkxLkS2zMpqMP8l8wcnobNU3FIcYe8rGGtZTkpEHD7I7XKiZbENY1EbzLu/ZltBHsS1IvgjHEzBa3BWv/XIe9iruKkwhqzohZ8TW67Qfa2HZnfSvrAdU0iuN2HXUbm84t+/fZI5/H+GZk5HOv6LXmsxtgPKOYet6u6vrUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"표\"\n        title=\"쓰레드와 프로세스 성능비교\"\n        src=\"/static/bc639605e74b4eaf4d87a62cab8a0bbe/0b533/result.png\"\n        srcset=\"/static/bc639605e74b4eaf4d87a62cab8a0bbe/fac75/result.png 125w,\n/static/bc639605e74b4eaf4d87a62cab8a0bbe/63868/result.png 250w,\n/static/bc639605e74b4eaf4d87a62cab8a0bbe/0b533/result.png 500w,\n/static/bc639605e74b4eaf4d87a62cab8a0bbe/1d69c/result.png 750w,\n/static/bc639605e74b4eaf4d87a62cab8a0bbe/6c2f2/result.png 767w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">쓰레드와 프로세스 성능비교</figcaption>\n  </figure></td>\n</tr>\n</tbody>\n</table>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-주1\">데이터분석 준전문가 (Advanced Data Analytics Semi-Professional)<a href=\"#fnref-%EC%A3%BC1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-주2\"><a href=\"https://boto3.amazonaws.com/v1/documentation/api/1.26.94/reference/services/lambda/client/invoke_async.html\">invoke_async - Boto3 Docs 1.26.94 documentation</a><a href=\"#fnref-%EC%A3%BC2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/solving-ai-concurrent-issue/"},"frontmatter":{"title":"AI 동시성 이슈 극복 과정과 성능 개선 (feat. AWS Lambda)","date":"October 25, 2023","description":"AI 알고리즘 연산 동시성 이슈를 고민하고,\nAWS Lambda와 병렬 처리로 극복하는 과정을 기록해 봤습니다.\n","author":{"name":"장진수","avatar":"https://avatars.githubusercontent.com/u/19955904","greeting":"원프레딕트 백엔드 엔지니어"}}},"previous":{"fields":{"slug":"/growing-up-with-good-peers/"},"frontmatter":{"title":"좋은 동료와 함께 자라기"}},"next":null},"pageContext":{"id":"4449dd8e-b371-56aa-a607-29f2656876eb","previousPostId":"23ea8874-3dd4-5c46-a8c3-42cf81e50af1","nextPostId":null}},"staticQueryHashes":["2094693779"],"slicesMap":{}}
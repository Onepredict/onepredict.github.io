{"componentChunkName":"component---src-templates-blog-post-js","path":"/typescript-schema-test/","result":{"data":{"site":{"siteMetadata":{"title":"Onepredict Engineering"}},"markdownRemark":{"id":"134cb196-3290-5ccd-9e39-82b0fb829a6d","excerpt":"기존에 발행된 글을\n정리해서 다시 소개합니다.  API 테스트 도입 모든 개발자는 테스트 코드를 작성해 품질을 향상하려고 노력한다.\n수많은 테스트 도구가 제공되고 있고, 다양한 방식으로 테스트를 진행하고 있다.\n많은 테스트 방법 중에서 API Type Schema…","html":"<blockquote>\n<p><a href=\"https://tech.onepredict.ai/7e578d89-4325-4ee2-9b62-e48b12b1e593\">기존에 발행된 글</a>을\n정리해서 다시 소개합니다. <sup id=\"fnref-주1\"><a href=\"#fn-주1\" class=\"footnote-ref\">주1</a></sup></p>\n</blockquote>\n<h2 id=\"api-테스트-도입\" style=\"position:relative;\"><a href=\"#api-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8F%84%EC%9E%85\" aria-label=\"api 테스트 도입 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>API 테스트 도입</h2>\n<p>모든 개발자는 테스트 코드를 작성해 품질을 향상하려고 노력한다.\n수많은 테스트 도구가 제공되고 있고, 다양한 방식으로 테스트를 진행하고 있다.\n많은 테스트 방법 중에서 API Type Schema 테스트를 도입한 부분에 대하여\n정리하려고 한다.\n앱을 개발할 때 타입스크립트로 타입에 관련된 에러는 컴파일 시점에, 타입 에러는\n많이 잡을 수 있게 되었지만, 서버에 API를 호출하여 가져오는 데이터는 백앤드에서\n설정한 모델을 보면서 개발을 진행해야 한다.\n이때 만약 “별문제 없겠지”라는 마음으로 API Response Data 모델을 변경하거나\n제거한 상태로 앱을 배포하면 어떻게 될까?</p>\n<p>앱은 변경된 API를 사용하는 곳에서 <strong>에러</strong>를 낼 것이다. 😭</p>\n<blockquote>\n<p><strong>이 글에서 CI/CD는 GitHub Actions를 사용한다.</strong><sup id=\"fnref-주2\"><a href=\"#fn-주2\" class=\"footnote-ref\">주2</a></sup></p>\n</blockquote>\n<p>테스트 체계가 잘 잡혀있다면 QA나 다른 테스트에서 확인할 수 있지만,\n테스트 관련 체계가 없다면 배포 이후에 오류 및 버그를 보고 다시 확인하여\n재배포를 하게 되는 일이 자주 발생하게 된다.\n배포되기 전에 테스트 Job을 추가하여 좀 더 안정성 있는 배포를 해보자는\n생각이 들었다.</p>\n<p>이번 글에서는 언제든지 변할 수 있는 API Response 값과 스키마를 테스트하는\n방법에 대하여 이야기하려고 한다.\nSwagger로 표현된 API 모델을 이용해 <strong>TypeScript 파일을 자동 생성</strong>하고,\n생성된 파일을 이용하여 <strong>API Response Schema를 생성</strong>하여 Ajv로 스키마와\n값을 비교할 수 있는 <strong>Jest 테스트 코드를 작성하는 방법</strong>에 대하여 알아보자.</p>\n<h2 id=\"테스트-flow\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-flow\" aria-label=\"테스트 flow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 Flow</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 738px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d4d4ec669dad9b93918cb12be7e7e962/774b6/test-flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.984375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAeUlEQVR42g2L4Q6CIBgAff8Ha7lqoEEiChRYw1JX0TAT/WK73Y/bLskri9kVl7dj3fLGzWH130DVQOqWygcRdyK7i3UA4KdF2JHKjptXvJh+JnuqUWEOJx0pm/cvLM5PO2rS/LzNVPQGiUr3AOtnnJlxaaYwtzEibv9u22oeVA/qFAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Test Flow\"\n        title=\"\"\n        src=\"/static/d4d4ec669dad9b93918cb12be7e7e962/774b6/test-flow.png\"\n        srcset=\"/static/d4d4ec669dad9b93918cb12be7e7e962/6f3f2/test-flow.png 256w,\n/static/d4d4ec669dad9b93918cb12be7e7e962/01e7c/test-flow.png 512w,\n/static/d4d4ec669dad9b93918cb12be7e7e962/774b6/test-flow.png 738w\"\n        sizes=\"(max-width: 738px) 100vw, 738px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"openapigenerator\" style=\"position:relative;\"><a href=\"#openapigenerator\" aria-label=\"openapigenerator permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenAPIGenerator</h2>\n<blockquote>\n<p>💡 Swagger UI는 Live Demo를 사용했다.\n<a href=\"https://petstore.swagger.io/?_ga=2.206759571.1629789658.1640134381-1349736674.1637807907#/pet/getPetById\">링크</a></p>\n</blockquote>\n<p><a href=\"https://github.com/ferdikoomen/openapi-typescript-codegen\">OpenAPI Typescript Codegen</a>을\n사용해, Swagger에서 정의한 모델을 TypeScript 코드로 만든다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> path <span class=\"token keyword\">from</span> <span class=\"token string\">\"path\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> generate<span class=\"token punctuation\">,</span> HttpClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"openapi-typescript-codegen\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> specURL <span class=\"token operator\">=</span> <span class=\"token string\">\"https://petstore.swagger.io/v2/swagger.json\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> outputPath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>\n  path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"../..\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"__apiTypesTemp__\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">swaggerModelGenerate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> <span class=\"token function\">generate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      input<span class=\"token operator\">:</span> specURL<span class=\"token punctuation\">,</span>\n      output<span class=\"token operator\">:</span> outputPath<span class=\"token punctuation\">,</span>\n      httpClient<span class=\"token operator\">:</span> HttpClient<span class=\"token punctuation\">.</span><span class=\"token constant\">AXIOS</span><span class=\"token punctuation\">,</span>\n      exportCore<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      exportServices<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      exportModels<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      useOptions<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      useUnionTypes<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      exportSchemas<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">swaggerModelGenerate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">🚀 model 생성 완료</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">specURL</code>: Swagger Basic Structure 파일(JSON or YAML) URL</li>\n<li><code class=\"language-text\">outputPath</code>: 모델 파일이 만들어질 위치</li>\n<li><code class=\"language-text\">generate</code>: SwaggerModel을 만드는 함수\n<ul>\n<li>매개변수\n<ul>\n<li><code class=\"language-text\">input</code>: Swagger Basic Structure 정보</li>\n<li><code class=\"language-text\">output</code>: 파일이 만들어질 위치</li>\n<li><code class=\"language-text\">httpClient</code>: HTTP 클라이언트 (fetch / xhr / node / axios)</li>\n<li><code class=\"language-text\">exportCore</code>: Core 정보 생성 여부</li>\n<li><code class=\"language-text\">exportService</code>: Service 정보 생성 여부</li>\n<li><code class=\"language-text\">exportModel</code>: Model 정보 생성 여부\n<ul>\n<li>백앤드 정의한 Type Model를 가지고 TypeScript 파일을 생성하여\n프론트앤드에서 사용한다.</li>\n</ul>\n</li>\n<li><code class=\"language-text\">useOptions</code>: Argument 코드 스타일 규칙</li>\n<li><code class=\"language-text\">useUnionTypes</code>: TypeScript에서 enum 대신 Union Type 사용 여부</li>\n<li><code class=\"language-text\">exportSchemas</code>: 스키마 정보 생성 여부</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p><code class=\"language-text\">ts-node</code>를 사용하여 OpenAPIGenerator를 실행하면 output 경로에 파일이 생성된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f81c284a4cc631b77c17aeca81c693a5/c88ae/pet-model.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.265625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAAByElEQVR42n2QS0sbYRSG3QvVhSGKRk2NFUUqxngpmgaFuNCYTCq6cFG68be0qAnqQouFiP4DwU03gqKmBofEuWRu34wzMZNExBqrk0XIzHg0l2UPZ3H4OM/3vu+pS/IyxSkodSsoOUHOsWI2idKsqLLXmfw/zTAM0zS3f/4a83hn55dmfPOuEffXb8vmW9Vx15njaDyRlBhJJbnU7yP89IKI0+iKVf7mnw1Dh6WV1XCjxdbj9k8MDHW12n1zXyowqJ3FiASFWEmlhZvTGIUT/BUjUcJNDQ6FNy3NnT1uzDM43G5z+LHFGpyN4jTJKayUARgnBYJVGFGlUfrhsQqHNpqsHb0Tc8MfnZYWuz+wUIGRksMJATCAwfZJlMZJBCliCf7u/tE0XzOvhNY7Wh3jnsCY61N723sMq8JwJ9CBTiKV4pXzSypOiyQnJxj5/uHJfDtYWbnvM+Z1jfbbPwRrtsVUjpMyvJyF8Ei5hZlBafgRXvJPhbLtMGRusfd6glNDo202RyBYhTVNe9a0QqFQLBZ13YCGqg2lUgmWvv9Yq2+wOpyTzu6+dw1W77SvApv/LV1/VY7+iW1sbu1Hdvcjezs7kYODwzL8AqUSjOxAJDR2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Swagger Pet Model과 생성된 Model Type\"\n        title=\"\"\n        src=\"/static/f81c284a4cc631b77c17aeca81c693a5/2bef9/pet-model.png\"\n        srcset=\"/static/f81c284a4cc631b77c17aeca81c693a5/6f3f2/pet-model.png 256w,\n/static/f81c284a4cc631b77c17aeca81c693a5/01e7c/pet-model.png 512w,\n/static/f81c284a4cc631b77c17aeca81c693a5/2bef9/pet-model.png 1024w,\n/static/f81c284a4cc631b77c17aeca81c693a5/71c1d/pet-model.png 1536w,\n/static/f81c284a4cc631b77c17aeca81c693a5/c88ae/pet-model.png 1541w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> Category <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Category'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> Tag <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Tag'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">Pet</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    id<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n    category<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Category<span class=\"token punctuation\">;</span>\n    name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    photoUrls<span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n    tags<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>Tag<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">/**\n     * pet status in the store\n     */</span>\n    status<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token string\">'available'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'pending'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'sold'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Swagger에서 정의한 Model 기반으로 TypeScript 코드가 자동으로 생성된 걸 확인할\n수 있다.</p>\n<blockquote>\n<p>💡 Swagger Model을 확실하게 정의하지 않은 상태라면 자동으로 생성된 파일을\n수정해야 하는 경우가 발생하므로 백앤드와 함께 Model을 잘 맞추는 게 중요하다.</p>\n</blockquote>\n<h2 id=\"jsonschemagenerator\" style=\"position:relative;\"><a href=\"#jsonschemagenerator\" aria-label=\"jsonschemagenerator permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JsonSchemaGenerator</h2>\n<p><a href=\"https://github.com/YousefED/typescript-json-schema\">typescript-json-schema</a>를\n사용해 Schema를 생성한다.</p>\n<blockquote>\n<p>💡 <a href=\"https://json-schema.org/draft-07/json-schema-release-notes.html\">JSON Schema Draft-07 스펙</a>으로 생성한다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> path <span class=\"token keyword\">from</span> <span class=\"token string\">\"path\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> fs <span class=\"token keyword\">from</span> <span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> <span class=\"token constant\">TJS</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"typescript-json-schema\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> pipe <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../utils/pipe\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> getAllFiles <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../utils/fileFn\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">BASE_PATH</span> <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"../..\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> settings<span class=\"token operator\">:</span> <span class=\"token constant\">TJS</span><span class=\"token punctuation\">.</span>PartialArgs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  required<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> compilerOptions<span class=\"token operator\">:</span> <span class=\"token constant\">TJS</span><span class=\"token punctuation\">.</span>CompilerOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  strictNullChecks<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getFiles</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">getAllFiles</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token constant\">BASE_URL</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"apiSchemaTypes\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> makeGenerator <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>file<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> IGenerator <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> program <span class=\"token operator\">=</span> <span class=\"token constant\">TJS</span><span class=\"token punctuation\">.</span><span class=\"token function\">getProgramFromFiles</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">,</span> compilerOptions<span class=\"token punctuation\">,</span> <span class=\"token constant\">BASE_URL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> generator <span class=\"token operator\">=</span> <span class=\"token constant\">TJS</span><span class=\"token punctuation\">.</span><span class=\"token function\">buildGenerator</span><span class=\"token punctuation\">(</span>program<span class=\"token punctuation\">,</span> settings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    generator<span class=\"token operator\">:</span> generator <span class=\"token keyword\">as</span> <span class=\"token constant\">TJS</span><span class=\"token punctuation\">.</span>JsonSchemaGenerator<span class=\"token punctuation\">,</span>\n    file<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">makeSymbols</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> generator<span class=\"token punctuation\">,</span> file <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> IGenerator<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> removePrefix <span class=\"token operator\">=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> f<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"STD.ts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".ts\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> filesStr <span class=\"token operator\">=</span> removePrefix<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\", \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> symbols <span class=\"token operator\">=</span> generator<span class=\"token punctuation\">.</span><span class=\"token function\">getUserSymbols</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> schemas <span class=\"token operator\">=</span> symbols<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">symbol</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>filesStr<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">symbol</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> schemaFolderPath <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"../../__schema__\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>fs<span class=\"token punctuation\">.</span><span class=\"token function\">existsSync</span><span class=\"token punctuation\">(</span>schemaFolderPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">mkdirSync</span><span class=\"token punctuation\">(</span>schemaFolderPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Schema 파일 변환을 시작합니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  schemas<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>schema<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> schemaDefine <span class=\"token operator\">=</span> generator<span class=\"token punctuation\">.</span><span class=\"token function\">getSchemaForSymbol</span><span class=\"token punctuation\">(</span>schema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>schemaDefine<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    fs<span class=\"token punctuation\">.</span><span class=\"token function\">writeFileSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>schemaFolderPath<span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>schema<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">Schema.json</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"파일변환종료\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>getFiles<span class=\"token punctuation\">,</span> makeGenerator<span class=\"token punctuation\">,</span> makeSymbols<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">typescript-json-schema</code>를 줄여서 TJS라 하겠다.</p>\n<ul>\n<li><code class=\"language-text\">settings</code>에서 TJS 셋팅 값을 셋팅한다.</li>\n<li><code class=\"language-text\">compilerOptions</code>에서 TJS 컴파일 옵션을 셋팅한다.</li>\n<li><code class=\"language-text\">getFiles</code> 함수는 <code class=\"language-text\">apiSchemaTypes</code> 디렉터리를 재귀적으로 탐색해서 스키마를\n만들어야 하는 파일을 모두 찾는다.</li>\n<li><code class=\"language-text\">makeGenerator</code> 함수는 스키마 유형 정보를 얻고, 스키마 정보를 생성한다.</li>\n<li><code class=\"language-text\">makeSymbols</code> 함수는 <code class=\"language-text\">symbols</code>를 찾아 TJS로 스키마 정의로 변환하고,\n<code class=\"language-text\">__schema__</code> 디렉터리 안에 <code class=\"language-text\">Schema</code> 접미어가 붙은 이름의 파일을 만든다.</li>\n</ul>\n<p>스키마 정보도 추출했으니, 이제 API에서 받은 데이터 구조와 스키마를 비교해서\n일치하는지 확인하는 작업만 추가하면 된다.</p>\n<h2 id=\"jest--ajv-validator\" style=\"position:relative;\"><a href=\"#jest--ajv-validator\" aria-label=\"jest  ajv validator permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Jest + AJV validator</h2>\n<p><a href=\"https://ajv.js.org/\">Ajv JSON schema validator</a>를 사용해 Schema 파일과\nAPI Response Data에 대한 검증을 진행한다.</p>\n<blockquote>\n<p>Default 값은 Draft-07이지만, 다른 버전을 사용할 수 있는 옵션이 있다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> Ajv<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> JSONSchemaType <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"ajv\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">validate</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token constant\">JSC</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> data<span class=\"token operator\">:</span> object<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> ajv <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Ajv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> allErrors<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// validate 메서드 호출시 오류는 덮어쓰므로 변수에 할당해서 사용해야 함.</span>\n  <span class=\"token keyword\">const</span> valid <span class=\"token operator\">=</span> ajv<span class=\"token punctuation\">.</span><span class=\"token function\">validate</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSC</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// errorText는 ajv-errors 설치하여 메시지는 따로 정의할 수 있다.</span>\n  <span class=\"token keyword\">const</span> errorText <span class=\"token operator\">=</span> ajv<span class=\"token punctuation\">.</span><span class=\"token function\">errorsText</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    errorText<span class=\"token punctuation\">,</span>\n    valid<span class=\"token operator\">:</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>valid<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">validate</code> 함수는 파라미터 <code class=\"language-text\">JSC</code>로 위에서 생성한 JSON Schema를 받고,\n<code class=\"language-text\">data</code>로 API Response Data를 받아 JSON Schema와 일치하는지 검사하며,\n만약 error가 있다면 error에 대한 message를 리턴한다.</li>\n</ul>\n<p>이제 Jest를 사용해 테스트해 보자.</p>\n<p>Matchers는 Jest Expect에서 제공하는 유효성 검사 외의 다른 유효성 검사 추가해서\n사용할 수 있도록 도와준다.</p>\n<p>JSON 스키마를 검사하는 `validate`` 함수를 Jest Expect에 추가한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">declare</span> global <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">namespace</span> jest <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Matchers<span class=\"token operator\">&lt;</span><span class=\"token constant\">R</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">{</span>\n       <span class=\"token function\">toMatchJSC</span><span class=\"token punctuation\">(</span>data<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token constant\">R</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>`toMatchJSC`` 함수를 Jest Extend로 추가한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> validate <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../utils/validate\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> extendJSCMatcher <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  expect<span class=\"token punctuation\">.</span><span class=\"token function\">extend</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function\">toMatchJSC</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSC</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> data<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> schemaValid <span class=\"token operator\">=</span> <span class=\"token function\">validate</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSC</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> pass <span class=\"token operator\">=</span> schemaValid<span class=\"token punctuation\">.</span>valid<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> errorText <span class=\"token operator\">=</span> schemaValid<span class=\"token punctuation\">.</span>errorText<span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pass<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n          pass<span class=\"token punctuation\">,</span>\n          <span class=\"token function-variable function\">message</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">데이터 스키마 매칭 통과</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        pass<span class=\"token punctuation\">,</span>\n        <span class=\"token function-variable function\">message</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">데이터 스키마 매칭 오류 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>errorText<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Spec 파일을 만들어 스키마 테스트 코드를 작성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> extendJSCMatcher <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../../jestExt\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> fetchPetId <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../../api/Pet/Pet\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> petSchema <span class=\"token keyword\">from</span> <span class=\"token string\">\"../../../__schema__/StocksSchema\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">extendJSCMatcher</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// params</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">PET_ID</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Pet api Pet Group\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pet/{petId} api\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"정상 처리(200)\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PET_ID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toEqual</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetchPetId</span><span class=\"token punctuation\">(</span><span class=\"token constant\">PET_ID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>petSchema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMatchJSC</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>먼저 <code class=\"language-text\">extendJSCMatcher</code> 함수를 호출한다.</li>\n<li><code class=\"language-text\">fetch</code>로 API를 호출하고, 응답으로 받은 <code class=\"language-text\">data</code>와 생성한 <code class=\"language-text\">petSchema</code>를 비교해\n일치하는지 확인한다.</li>\n</ul>\n<p>추가적으로 에러 / 필수 파라미터  / 잘못된 파라미터 값 등을 좀더 디테일하게\n작업하면 조금 더 타이트하게 체크할 수 있다.</p>\n<p>WebStorm(IDE)에서 테스트를 실행해 보면, 다음과 같이 보인다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/944443248b22072c6a21e1ee01c67f41/f98ee/webstorm-test-result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2UlEQVR42mOITcxOySxNzS5PTC+Kjk+PSciMS8n1DYpes27T////+ybNSEoryilpzClpyiqsS0rPT8kqSs0ti4xPX7l6A4OKtp6+mY2OoZWiqq6CiraKpqGqgZWQhMLkqTOAmhOS0hSUFPSMzVU0jWQU1KRkleRVtOQ0DQRFJVvaOhkUVLVMbOwsrJ30TaxUtfSV1bXVtfREpRSmzZgN1JySkiOnpGHnYGvt4GFgZqeha6qkoa+mZSiloNndP4VBRl5FWVPb0NLGwtZFXdtAQUVTVVNXSEwGYnNSep66dZKlT757WJFXdLW1b4GRW66pZ76OQ/rUeesZpOVVlNS0gXoUVbUgSFVTj19EcsKkqUDNiUmZErKqKpoGimo6QKSkrqukrqeqZSgmrdTe1csgraCqrK6jpKqNVXNMfLKYlDzQLzBZoB2aKho6IpKybR3dDMBgAGpWVNMC2g9Balr6AqJSEydDNCeJSSmAFMCMBiIVDV0RSbm2jh4GSVklBWUNeWUNOSV1CALq5xEQ6584Gag5Ki5RVFJeSU1HQUVLXlkTgoBcITHZ1vZuhgMHD508dfrU6TNAEoKA7CPHjj958hSo+dLlK0AFZ86eA6LTZ87C0YmTpx49fgwAMwK3FRqOTREAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"테스트 통과, 테스트 실패\"\n        title=\"\"\n        src=\"/static/944443248b22072c6a21e1ee01c67f41/2bef9/webstorm-test-result.png\"\n        srcset=\"/static/944443248b22072c6a21e1ee01c67f41/6f3f2/webstorm-test-result.png 256w,\n/static/944443248b22072c6a21e1ee01c67f41/01e7c/webstorm-test-result.png 512w,\n/static/944443248b22072c6a21e1ee01c67f41/2bef9/webstorm-test-result.png 1024w,\n/static/944443248b22072c6a21e1ee01c67f41/71c1d/webstorm-test-result.png 1536w,\n/static/944443248b22072c6a21e1ee01c67f41/f98ee/webstorm-test-result.png 1808w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>테스트가 실패하면 아래와 같은 메시지가 발생하게 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 348px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a8a808ed02767943b69ff812fd7fd922/34ea4/error-message.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.546875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAYUlEQVR42h2MWw6EMAzEuBJQaFLyaqCw0t7/Poz4GcmWxlPZLNtJ1a3lz27lbBRDB/Dvj1AfcjmnUjdOoHA/KLzlvOq0FFWKuhs+eZxcg3azL3HJwDp3FGGQEA6hgASuRV/X+ByDzJv/qQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"에러 메시지\"\n        title=\"\"\n        src=\"/static/a8a808ed02767943b69ff812fd7fd922/34ea4/error-message.png\"\n        srcset=\"/static/a8a808ed02767943b69ff812fd7fd922/6f3f2/error-message.png 256w,\n/static/a8a808ed02767943b69ff812fd7fd922/34ea4/error-message.png 348w\"\n        sizes=\"(max-width: 348px) 100vw, 348px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"github-actions-job-등록\" style=\"position:relative;\"><a href=\"#github-actions-job-%EB%93%B1%EB%A1%9D\" aria-label=\"github actions job 등록 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GitHub Actions Job 등록</h2>\n<p><code class=\"language-text\">package.json</code> 파일에 <code class=\"language-text\">test</code> script 명령어를 추가하고, GitHub Actions Workflow\n파일(<code class=\"language-text\">.github/workflows/ci.yaml</code>)에 Step으로 등록하면 된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/daf25d28ade33f9f01c4d75677d96dc0/5819f/github-workflow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.328125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABZ0lEQVR42o1SXW+DMAzs8wrlGxIMDSGBESBQ6NoyUfVh//9HzbSbVvWhnRRZVpKzz3deOUFiumQ7KipkIvqk6CmvfZBOmBp2ZDrkyVkh2LAiP2GgSlbtM/VRjhfenJxw+xps+4Cf7BAimXuEB1CGaWnYoWGFz5FXcACmTUyXQlvwbijGmddHwqpYaJrVMW8pb0BoklWY4A2WtnHSK6krbYe8bcKIl3w85LsjFDsqOo/m+Lxx6cPBNn+dNwGkPrTA+lJ99vN5uBzbUw+57UTGS9qGHwsPRsYPujnrae5Oo2jPovF8WP9H7fWi9pYPuuhmoadU9jiY9TvYa6scmmx1I7s5LQeUB9m89OlHbQS7cUKkjFKFOgcgLRdubi3xlljh2gowf+i8+Gz5cdwUoAvaSKoEFDVSYGqftxPS4e2Uvg9YdDHpHuxe1xA9YGMtZs12bdYPXO9lP1eHL4xoL2GKZCpiFa7dPfgb69dIOI1halwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GitHub Actions Workflow 파일\"\n        title=\"\"\n        src=\"/static/daf25d28ade33f9f01c4d75677d96dc0/2bef9/github-workflow.png\"\n        srcset=\"/static/daf25d28ade33f9f01c4d75677d96dc0/6f3f2/github-workflow.png 256w,\n/static/daf25d28ade33f9f01c4d75677d96dc0/01e7c/github-workflow.png 512w,\n/static/daf25d28ade33f9f01c4d75677d96dc0/2bef9/github-workflow.png 1024w,\n/static/daf25d28ade33f9f01c4d75677d96dc0/5819f/github-workflow.png 1042w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>GitHub Actions를 실행하여 배포를 하게 되면 빌드하기 전에 API schema 테스트가\n먼저 진행되고, 만약 변경된 schema 정보가 있다면 error가 발생하며 어떤 API에\nschema정보가 잘못 되었는지 확인할 수 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1024px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fdfb1690c8b2fe5e2dc9a901ebdede69/387f2/github-actions-failed.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.421875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuUlEQVR42o2Q2QqDMBBFU6tmn5jEBHEpLlRpsf//e50qSPGlhfMQ5t47S4gEb3zFVZExlWT8J9dcIPjIORBjowu1i40ER6Vhf0A3BHgCxre3KdY9hpUphXY7XNtvjvoBmknKlCpKFxqL80MtjUcBV8LeuYDPHAE516flLylLqSQooIx5bQPYsHW1WElStkHRir791AMs4h+RjGsBbpzXcXkN89rfn7fp0Q1LO8yx6at2LKuOyeKU38NvtXYR5FB6gjoAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"GitHub Actions Schema Test Error\"\n        title=\"\"\n        src=\"/static/fdfb1690c8b2fe5e2dc9a901ebdede69/2bef9/github-actions-failed.png\"\n        srcset=\"/static/fdfb1690c8b2fe5e2dc9a901ebdede69/6f3f2/github-actions-failed.png 256w,\n/static/fdfb1690c8b2fe5e2dc9a901ebdede69/01e7c/github-actions-failed.png 512w,\n/static/fdfb1690c8b2fe5e2dc9a901ebdede69/2bef9/github-actions-failed.png 1024w,\n/static/fdfb1690c8b2fe5e2dc9a901ebdede69/387f2/github-actions-failed.png 1518w\"\n        sizes=\"(max-width: 1024px) 100vw, 1024px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>프론트엔드에서 받는 API Response Data에 관련된 타입은 Swagger Model에 맞춰\n자동으로 TypeScript 파일로 생성되기 때문에, API가 추가되더라도 타입 작성에\n대한 고민이 사라졌고, 백앤드에서 API를 긴급 패치 하더라도\nAPI Schema Validate를 통해 확인되기 때문에 Key/Type 변경 및 API 제거 등을\n확인할 수 있게 됐다.\n또 변경된 API Schema 정보를 알고 있어서, 관련 화면에 대한 테스트도 가능하여\n더 빠르게 상황에 대처할 수 있게 되었다.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-주1\">2022년 1월 12일, 원프레딕트 기술 블로그에 발행된 글.<a href=\"#fnref-%EC%A3%BC1\" class=\"footnote-backref\">↩</a></li>\n<li id=\"fn-주2\">2023년 9월 기준으로 원프레딕트는 GitLab CI/CD를 사용하고 있습니다.<a href=\"#fnref-%EC%A3%BC2\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/typescript-schema-test/"},"frontmatter":{"title":"TypeScript로 API JSON Schema 테스트하기","date":"September 29, 2023","description":"모든 개발자는 테스트 코드를 작성해 품질을 향상하려고 노력한다.\n","author":{"name":"박준용","avatar":"/images/avatars/jund34.png","greeting":"원프레딕트 프론트엔드 엔지니어"}}},"previous":{"fields":{"slug":"/using-keyword-part2/"},"frontmatter":{"title":"JavaScript의 using을 사용해 보자 - Part 2"}},"next":{"fields":{"slug":"/typescript-algebric-type/"},"frontmatter":{"title":"TypeScript를 이용한 대수적 타입"}}},"pageContext":{"id":"134cb196-3290-5ccd-9e39-82b0fb829a6d","previousPostId":"f4045acf-0a95-512e-b18b-6cfc2628c3d1","nextPostId":"d6f7f694-22c7-51a5-86e8-60704914dc4c"}},"staticQueryHashes":["2094693779"],"slicesMap":{}}
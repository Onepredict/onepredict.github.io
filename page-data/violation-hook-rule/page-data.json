{"componentChunkName":"component---src-templates-blog-post-js","path":"/violation-hook-rule/","result":{"data":{"site":{"siteMetadata":{"title":"Onepredict Engineering"}},"markdownRemark":{"id":"65887d3b-35bf-5ed1-92be-0e3cdbc4735f","excerpt":"프론트 데스크에서 발표한 내용을 엔지니어링 블로그에 공유합니다.  Intro 시발점 - 문제의 코드 Why ? 왜 그랬어? Why ! 외 않되! How? 그래서 어떻게 했어? 커스텀 훅 생성 정리 Intro…","html":"<blockquote>\n<p>프론트 데스크에서 발표한 내용을 엔지니어링 블로그에 공유합니다. <sup id=\"fnref-주1\"><a href=\"#fn-주1\" class=\"footnote-ref\">주1</a></sup></p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#intro\">Intro</a></li>\n<li><a href=\"#%EC%8B%9C%EB%B0%9C%EC%A0%90---%EB%AC%B8%EC%A0%9C%EC%9D%98-%EC%BD%94%EB%93%9C\">시발점 - 문제의 코드</a></li>\n<li><a href=\"#why--%EC%99%9C-%EA%B7%B8%EB%9E%AC%EC%96%B4\">Why ? 왜 그랬어?</a></li>\n<li><a href=\"#why--%EC%99%B8-%EC%95%8A%EB%90%98\">Why ! 외 않되!</a></li>\n<li><a href=\"#how-%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%96%88%EC%96%B4\">How? 그래서 어떻게 했어?</a></li>\n<li><a href=\"#%EC%BB%A4%EC%8A%A4%ED%85%80-%ED%9B%85-%EC%83%9D%EC%84%B1\">커스텀 훅 생성</a></li>\n<li><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></li>\n</ul>\n</div>\n<h2 id=\"intro\" style=\"position:relative;\"><a href=\"#intro\" aria-label=\"intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Intro</h2>\n<p><img src=\"https://mblogthumb-phinf.pstatic.net/MjAxNzA5MTZfMTMz/MDAxNTA1NTIwMTAwMjIw.NxHcV2ca3Ntx74LEtXS1PlP_96IL4mN6qUt2UwQTaTcg.OQRjxupiLfoeHCDwwurI-eo4cQZsGQxO--2RSjhfthQg.GIF.jhhong0571/a5ba83fd23fbb405cdfe604a1b3d54a7_L9w7Ssdp1fPM9lZvGLv64cQ.gif?type=w800\" alt=\"도구탓\" title=\"도구탓\"></p>\n<p>흔히들 장인은 도구 탓을 하지 않는다고들 합니다.</p>\n<p>하지만 아이러니하게도 주니어 개발자도 그런 경우가 많지 않을까 생각해 봅니다.</p>\n<p>도구 탓이라고 표현했지만\n결국에는 사용하는 도구를 잘 이해하지 못하고 사용한다는 뜻입니다.</p>\n<p>왜냐하면 도구 탓을 하기 전에 본인 탓이 우선이기 때문입니다.</p>\n<p>아마 주니어 개발자라면 한 번쯤은 분명 내가 작성한 코드가 잘못됐을 것이라는\n생각을 해봤을 것입니다.</p>\n<p>오늘 나누고자 하는 주제 또한 저를 포함한 많은 리액트 주니어 개발자들이\n사용하는 것에만 신경 쓰고\n그 이유에 대해서는 생각하지 않을 때에 관한 내용입니다.</p>\n<p>부디 누군가의 옆구리를 찌르는 내용이길 바랍니다.</p>\n<h2 id=\"시발점---문제의-코드\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%B0%9C%EC%A0%90---%EB%AC%B8%EC%A0%9C%EC%9D%98-%EC%BD%94%EB%93%9C\" aria-label=\"시발점   문제의 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시발점 - 문제의 코드</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token keyword\">const</span> dataList <span class=\"token operator\">=</span> channels<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> idList <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span>\n\n    <span class=\"token operator\">...</span>생략<span class=\"token operator\">...</span>\n\n    <span class=\"token comment\">// eslint-disable-next-line react-hooks/rules-of-hooks</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">useCustomQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">ids</span><span class=\"token operator\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>idList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>어딘가 불편합니다</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// eslint-disable-next-line react-hooks/rules-of-hooks</span></code></pre></div>\n<p>참 거슬리는 문구가 아닐 수 없습니다</p>\n<p>해당 코드로 인해서 당연하게도 코드 리뷰 단계에서 동료들의 피드백을 받을 수 있었습니다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 988px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e21a38463509691d17eec46fed050e19/e4900/code-review-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42mWOWXLDIBBEdf8DOnHZiS1rZ0eShfYXpFS+MtSjqYFuJslXyaV/kA01eVfzWd25iQd3+eSuUq7NN7eopS8RQaJ3j9rcP+RqmfeFpNoMH0NKNtbUoyTtCrK+4hU1f9dkPuflXhTvijI0iFmf5gO1u5PjExFzzsCv8sElvdJ4RaUbSiuonaIQJaZ3dPHsZIWL98MWGPcpMjMx40OLGRx1r+imni2uxFlL/opTPDOKvEQrjVEG0UiMNmht8b7DGMsYRrZ1Y5kX1mVlnuZTh3lkjf2jkmMLIWBjsLUumv2JkAoTe6IRMdScvbZtabsuTnu8aU/fX+37Lz8IQ3zGLevE0AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"코드리뷰1\"\n        title=\"꼼꼼한 동료들의 코드리뷰 1\"\n        src=\"/static/e21a38463509691d17eec46fed050e19/e4900/code-review-1.png\"\n        srcset=\"/static/e21a38463509691d17eec46fed050e19/6f3f2/code-review-1.png 256w,\n/static/e21a38463509691d17eec46fed050e19/01e7c/code-review-1.png 512w,\n/static/e21a38463509691d17eec46fed050e19/e4900/code-review-1.png 988w\"\n        sizes=\"(max-width: 988px) 100vw, 988px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">꼼꼼한 동료들의 코드리뷰 1</figcaption>\n  </figure></p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 989px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7323446f593de7bdf70aa059630322e1/8ecb0/code-review-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.03125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8klEQVR42o2Q2W6DMBBF+f/fa6W0VcKS2BgD3jAQEoxvBkdtHhtLR/Y8zJnryRCBJmgcphJ8aVEZhh+ZQ94V+s2+jSJCDMj+hHMFfuvAvMDn5QvtqqGiS/TRPnlfqChhQUJKaBk+qgP6YFPKnS4YqNU8m/cB/wkFNXwvDGLtIeYWR1Uh12ccuwInepfyBNbk4KOAXF+r+P1BYnMv4UQJuaUddhKiFRC6gzQk7yWG0cFTPVDtryOm+4x5vSbM5KC9haV7us2IMSKLG+gEaGoq8hLswlCzGpzXuJwZmkairkXCGgs/+ISzLjG4AVoZLMuyi/AAUQHJP+6dA2wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"코드리뷰2\"\n        title=\"꼼꼼한 동료들의 코드리뷰 22\"\n        src=\"/static/7323446f593de7bdf70aa059630322e1/8ecb0/code-review-2.png\"\n        srcset=\"/static/7323446f593de7bdf70aa059630322e1/6f3f2/code-review-2.png 256w,\n/static/7323446f593de7bdf70aa059630322e1/01e7c/code-review-2.png 512w,\n/static/7323446f593de7bdf70aa059630322e1/8ecb0/code-review-2.png 989w\"\n        sizes=\"(max-width: 989px) 100vw, 989px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">꼼꼼한 동료들의 코드리뷰 22</figcaption>\n  </figure></p>\n<h2 id=\"why--왜-그랬어\" style=\"position:relative;\"><a href=\"#why--%EC%99%9C-%EA%B7%B8%EB%9E%AC%EC%96%B4\" aria-label=\"why  왜 그랬어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why ? 왜 그랬어?</h2>\n<p>베어링 개수만큼 각 베어링의 <code class=\"language-text\">channelId</code> 목록이 담긴 배열로 <code class=\"language-text\">map</code> 함수를 돌면서\n<code class=\"language-text\">useCustomQuery</code> 를 사용해 사용할 모든 <code class=\"language-text\">result</code>를 불러올 생각이었습니다.</p>\n<p>당연히 규칙에 위반되기 때문에 ‘<code class=\"language-text\">커스텀 훅</code>을 생성해서 (나중에) 처리해야지!’라고\n생각만 한 뒤 바로 수정하지 않고,\n에러를 무시하고 ‘차트를 그리는 게 먼저다!’라는 핑계로 넘어가고는\n잊어버렸다는 핑계였습니다.</p>\n<p>정리하자면,\n반복을 통해서 차트 상단에서 필요한 시그널 데이터를 모두 불러오자는\n목적이 있었으나\n‘<code class=\"language-text\">React Hook 규칙</code>에 대해서 정확히 이해하지 못하고 사용하면서 나온\n잘못이다.’입니다.</p>\n<h2 id=\"why--외-않되\" style=\"position:relative;\"><a href=\"#why--%EC%99%B8-%EC%95%8A%EB%90%98\" aria-label=\"why  외 않되 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why ! 외 않되!</h2>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 935px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/39721b1fe14cd5b15b88f61b71b68249/eb390/hook-rule.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABi0lEQVR42m2SC5OqMAyF9///urvrRZTyVFyFKhREnHGEszlx5fq4nckkDc3HSdoPyBqGAWEYwhiD9XqNLMuw2Ww0t1wukaYpoijCfD7HbDbTfF3XLMU4jnhcH/cki+5G8Gq1QpIkE+z+s6Io1Ox+D+caVFWFy+XyDLwpjKQwVkXGBKqScRAEWCwW8DxPc4QSHkcGUegjiSOcz+dXhYN88BGaGUwYwBeA7/vaIoE07qk4jmMkojqJDTZ5hHydqaC3lo/HFk1Tw7UNXNNILN45yR/Rdd1UwGKev14Hicdp/wYsbYn94YCyKHEQv91uYa1Vn+e5tsr4ES6VeF3TDNM4hffX0zZ5i/Rsk7f6+fWle17ObrdT9VT+OLsnIFdiE2R5BlveVLGQRnV1XaHvewVQ4R14Op3egeOv7D/NJ76rb7jK6VOglWWpz6NqZY4CJJRAghi/vsEnhdbZ2xwFwBnS0wgs7P42X/kBje+QZ9q2lcu5/h947qWdY4fu1E0qaGyt/1WnbXb/vtO/An8A+mdCVE0gwjAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hook규칙\"\n        title=\"Hook 규칙에 대한 공식문서\"\n        src=\"/static/39721b1fe14cd5b15b88f61b71b68249/eb390/hook-rule.png\"\n        srcset=\"/static/39721b1fe14cd5b15b88f61b71b68249/6f3f2/hook-rule.png 256w,\n/static/39721b1fe14cd5b15b88f61b71b68249/01e7c/hook-rule.png 512w,\n/static/39721b1fe14cd5b15b88f61b71b68249/eb390/hook-rule.png 935w\"\n        sizes=\"(max-width: 935px) 100vw, 935px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">Hook 규칙에 대한 공식문서</figcaption>\n  </figure></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ------------</span>\n<span class=\"token comment\">// 첫 번째 렌더링</span>\n<span class=\"token comment\">// ------------</span>\n<span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Mary'</span><span class=\"token punctuation\">)</span>           <span class=\"token comment\">// 1. 'Mary'라는 name state 변수를 선언합니다.</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>persistForm<span class=\"token punctuation\">)</span>     <span class=\"token comment\">// 2. 폼 데이터를 저장하기 위한 effect를 추가합니다.</span>\n<span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Poppins'</span><span class=\"token punctuation\">)</span>        <span class=\"token comment\">// 3. 'Poppins'라는 surname state 변수를 선언합니다.</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>updateTitle<span class=\"token punctuation\">)</span>     <span class=\"token comment\">// 4. 제목을 업데이트하기 위한 effect를 추가합니다.</span>\n\n<span class=\"token comment\">// -------------</span>\n<span class=\"token comment\">// 두 번째 렌더링</span>\n<span class=\"token comment\">// -------------</span>\n<span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Mary'</span><span class=\"token punctuation\">)</span>           <span class=\"token comment\">// 1. name state 변수를 읽습니다.(인자는 무시됩니다)</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>persistForm<span class=\"token punctuation\">)</span>     <span class=\"token comment\">// 2. 폼 데이터를 저장하기 위한 effect가 대체됩니다.</span>\n<span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Poppins'</span><span class=\"token punctuation\">)</span>        <span class=\"token comment\">// 3. surname state 변수를 읽습니다.(인자는 무시됩니다)</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>updateTitle<span class=\"token punctuation\">)</span>     <span class=\"token comment\">// 4. 제목을 업데이트하기 위한 effect가 대체됩니다.</span>\n\n<span class=\"token comment\">// ...</span></code></pre></div>\n<p>Hook의 호출 순서가 렌더링 간에 동일하다면\nReact는 지역적인 state를 각 Hook에 연동시킬 수 있습니다.\n하지만 Hook을 조건문 안에서(예를 들어 <code class=\"language-text\">persistForm</code> effect)\n호출한다면 어떤 일이 일어날까요?</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token comment\">// 🔴 조건문에 Hook을 사용함으로써 첫 번째 규칙을 깼습니다</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">!==</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token function\">persistForm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">'formData'</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">name !== ''</code> 조건은 첫 번째 렌더링에서 <code class=\"language-text\">true</code>이기 때문에 Hook은 동작합니다.\n하지만 사용자가 그다음 렌더링에서 폼을 초기화하면서\n조건을 <code class=\"language-text\">false</code>로 만들 겁니다.\n렌더링 간에 Hook을 건너뛰기 때문에 Hook 호출 순서는 달라지게 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Mary'</span><span class=\"token punctuation\">)</span>           <span class=\"token comment\">// 1. name state 변수를 읽습니다. (인자는 무시됩니다)</span>\n<span class=\"token comment\">// useEffect(persistForm)  // 🔴 Hook을 건너뛰었습니다!</span>\n<span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Poppins'</span><span class=\"token punctuation\">)</span>        <span class=\"token comment\">// 🔴 2 (3이었던). surname state 변수를 읽는 데 실패했습니다.</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span>updateTitle<span class=\"token punctuation\">)</span>     <span class=\"token comment\">// 🔴 3 (4였던). 제목을 업데이트하기 위한 effect가 대체되는 데 실패했습니다.</span></code></pre></div>\n<p>React는 두 번째 <code class=\"language-text\">useState</code> Hook 호출에 대해 무엇을 반환할지 몰랐습니다.\nReact는 이전 렌더링 때처럼 컴포넌트 내에서 두 번째 Hook 호출이\n<code class=\"language-text\">persistForm</code> effect와 일치할 것이라 예상했지만 그렇지 않았습니다.\n그 시점부터 건너뛴 Hook 다음에 호출되는 Hook이 순서가 하나씩 밀리면서\n버그를 발생시키게 됩니다.</p>\n<p>이것이 컴포넌트 최상위(the top of level)에서\nHook이 호출되어야만 하는 이유입니다.\n조건부로 effect를 실행하기를 원한다면, 조건문을 Hook 내부에 넣을 수 있습니다.</p>\n<h2 id=\"how-그래서-어떻게-했어\" style=\"position:relative;\"><a href=\"#how-%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%96%88%EC%96%B4\" aria-label=\"how 그래서 어떻게 했어 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How? 그래서 어떻게 했어?</h2>\n<p>저장소에 문제의 Merge Request를 올린 후 휴가를 떠난 저였습니다.</p>\n<p>휴가 복귀하니 문제의 코드들이 <code class=\"language-text\">main</code> branch에 merge가 된 상태였습니다.</p>\n<p>빠른 템포로 돌아가는 스프린트 와중에 코드 리뷰 중인 MR에 <code class=\"language-text\">approve</code> 버튼을\n눌렀을 동료들의 마음이 차마 가늠이 가지 않았습니다.</p>\n<p>하지만 이미 엎질러진 물!</p>\n<p>다시 태스크를 가져와서 개선하기로 했습니다.</p>\n<p>사실 가장 간단한 방법은...\n문제가 되는 <code class=\"language-text\">useCustomQuery</code>를 반복문 밖으로 빼는 겁니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">useCustomQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">ids</span><span class=\"token operator\">:</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>idList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> dataList <span class=\"token operator\">=</span> channels<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> idList <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// ...중략...</span>\n\n    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>문제가 되던 반복하면서 <code class=\"language-text\">useCustomQuery</code>를 쏘던 <code class=\"language-text\">result</code>를 밖으로 빼고,\n대신 반복문을 통해 얻은 모든 <code class=\"language-text\">channelId</code>가 담긴 배열을 인자로 넘겨줍니다.</p>\n<p>하지만 가만히 들여다봤을 때, 여전히 불편함이 가시질 않았습니다.</p>\n<p>그래서</p>\n<h2 id=\"커스텀-훅-생성\" style=\"position:relative;\"><a href=\"#%EC%BB%A4%EC%8A%A4%ED%85%80-%ED%9B%85-%EC%83%9D%EC%84%B1\" aria-label=\"커스텀 훅 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>커스텀 훅 생성</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useShaftCenterSignalData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  <span class=\"token parameter\"><span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> useOverviewSignalDataProps</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> channelData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> props<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> channelIds <span class=\"token operator\">=</span> channelData<span class=\"token operator\">?.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>channelIdList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">flat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> signalData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useCustomQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    channelIds\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// signal data 없음</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>signalData <span class=\"token operator\">===</span> <span class=\"token keyword\">undefined</span> <span class=\"token operator\">||</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>signalData<span class=\"token punctuation\">.</span>signals<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> defaultSignalData<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// signalData가 있는 경우</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> signals <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> signalData<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> shaftCenterSignalDataList <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>channelData<span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...중략...</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token function\">createShaft</span><span class=\"token punctuation\">(</span><span class=\"token function\">getSignalsByChannel</span><span class=\"token punctuation\">(</span>signals<span class=\"token punctuation\">,</span> channelIdList<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> shaftCenterSignalDataList<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>좋은 코드의 기준은 개개인이 다를 수 있겠지만\n불편함이 조금은 줄었을까요!</p>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>지금까지 주니어가(제가) 흔히 하는 실수인 <code class=\"language-text\">React Hook 규칙 위반 사례</code>와\n나아가서 <code class=\"language-text\">커스텀 훅을 통한 개선 방법</code>에 대해서 얘기해 봤습니다.</p>\n<p>이 주제를 논하고자 마음먹었을 때, 사실은 부끄러운 마음이 더 컸습니다.</p>\n<p>사실 흔히 하는 실수일 수 있으나 해서는 안 되는 실수이기도 하고,\n남들은 하지 않는 실수일 것이 분명했기 때문입니다.</p>\n<p>하지만 이 주제가 누군가에게는 공감을 일으킬 수 있으리라 생각했고,\n이처럼 사소하다고 느낄 수 있을 만한 부분도\n팀 단위에서 코드 리뷰가 이루어지고 있다는 부분을 강조하고 싶었습니다.</p>\n<p>돌이켜보면 사실은 저의 게으름이 자아낸 실수 아닌 실수라고 생각합니다.</p>\n<p>협업이 자연스레 이뤄지는 환경 속에서,\n내 로컬 검은 바탕에 써 내려간다고 해서\n나만 보는 코드가 아님을 항상 명심해야겠습니다.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-주1\">원프레딕트의 모든 프론트엔드 엔지니어는 매주 목요일에\n기술 주제를 나누는데, 이 모임의 이름이 ‘프론트 데스크’입니다.<a href=\"#fnref-%EC%A3%BC1\" class=\"footnote-backref\">↩</a></li>\n</ol>\n</div>","fields":{"slug":"/violation-hook-rule/"},"frontmatter":{"title":"장인은 도구탓을 하지 않는다. 주니어도 그렇다.","date":"November 01, 2023","description":"흔히들 장인은 도구 탓을 하지 않는다고들 합니다.\n","author":{"name":"박성택","avatar":"https://avatars.githubusercontent.com/u/76993672","greeting":"원프레딕트 프론트엔드 엔지니어"}}},"previous":{"fields":{"slug":"/solving-ai-concurrent-issue/"},"frontmatter":{"title":"AI 동시성 이슈 극복 과정과 성능 개선 (feat. AWS Lambda)"}},"next":{"fields":{"slug":"/reactive-programming/"},"frontmatter":{"title":"반응형 프로그래밍이란 무엇인가?"}}},"pageContext":{"id":"65887d3b-35bf-5ed1-92be-0e3cdbc4735f","previousPostId":"2b47cd0b-0494-513d-b443-73969dc93bf2","nextPostId":"af0f498e-421d-56f0-9dc3-c6d452bd4e5b"}},"staticQueryHashes":["2094693779"],"slicesMap":{}}